import{r as a,c as me,j as e,t as ue,o as xe,s as O,l as he,b as V,a as J,u as pe}from"./index-DhWX03Cy.js";import{S as W}from"./SearchableSelect-ClOu6u_R.js";import{Q as ge}from"./QrModal-D1uVr1n2.js";import{E as ye}from"./ErrorState-CQnIf7eq.js";import{g as be}from"./hosts-r3Q6BTCa.js";function G(){const t=new Date;return t.setMinutes(t.getMinutes()-t.getTimezoneOffset()),t.toISOString().slice(0,16)}function fe(t){const s=new Set(t.map(o=>o.company).filter(Boolean));return Array.from(s).sort()}const ve=xe({visitorName:O().min(2,"Visitor name must be at least 2 characters"),visitorEmail:O().email("Invalid email address").optional().or(he("")),visitorPhone:O().optional(),hostId:O().min(1,"Please select a host"),scheduledDate:O().min(1,"Scheduled date is required"),purpose:O().optional(),notes:O().optional()});function je({onSubmit:t,initialData:s,hosts:o,isLoading:i,isLoadingHosts:x}){var R,C,E;const[c,v]=a.useState(""),F=a.useMemo(()=>{var y;const l=fe(o);return(y=s==null?void 0:s.host)!=null&&y.company&&!l.includes(s.host.company)?[...l,s.host.company].sort():l},[o,(R=s==null?void 0:s.host)==null?void 0:R.company]),j=a.useMemo(()=>{if(!c)return[];const l=o.filter(y=>y.company===c);return s!=null&&s.host&&s.host.company===c&&!l.some(D=>String(D.id)===String(s.host.id))?[s.host,...l]:l},[o,c,s==null?void 0:s.host]),{register:g,handleSubmit:P,formState:{errors:d},reset:m,setValue:L,watch:T}=me({resolver:ue(ve),defaultValues:s||{visitorName:"",visitorEmail:"",visitorPhone:"",hostId:"",scheduledDate:G(),purpose:"",notes:""}}),p=T("hostId");a.useEffect(()=>{if(p){const l=o.find(y=>String(y.id)===String(p))??(s==null?void 0:s.host);l!=null&&l.company&&v(l.company)}else v("")},[p,o,s==null?void 0:s.host]);const S=l=>{v(l),L("hostId","",{shouldValidate:!0})},k=async l=>{await t(l),m(),v("")};return e.jsxs("form",{onSubmit:P(k),className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"visitorName",className:"block text-sm font-medium text-gray-700 mb-1",children:"Visitor Name *"}),e.jsx("input",{...g("visitorName"),type:"text",id:"visitorName",placeholder:"Enter visitor name",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",disabled:i}),d.visitorName&&e.jsx("p",{className:"text-sm text-red-600 mt-1",children:d.visitorName.message})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"visitorEmail",className:"block text-sm font-medium text-gray-700 mb-1",children:"Email"}),e.jsx("input",{...g("visitorEmail"),type:"email",id:"visitorEmail",placeholder:"Enter email address",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",disabled:i}),d.visitorEmail&&e.jsx("p",{className:"text-sm text-red-600 mt-1",children:d.visitorEmail.message})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"visitorPhone",className:"block text-sm font-medium text-gray-700 mb-1",children:"Phone"}),e.jsx("input",{...g("visitorPhone"),type:"tel",id:"visitorPhone",placeholder:"Enter phone number",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",disabled:i}),d.visitorPhone&&e.jsx("p",{className:"text-sm text-red-600 mt-1",children:d.visitorPhone.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Company *"}),e.jsx(W,{options:F.map(l=>({value:l,label:l})),value:c,onChange:S,placeholder:x?"Loading companies...":F.length===0?"No companies":"Type to search company...",disabled:i||x||F.length===0,isLoading:x,error:c||(C=d.hostId)==null?void 0:C.message,emptyMessage:"No company found"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Host / Contact Person *"}),e.jsx(W,{options:j.map(l=>({value:String(l.id),label:l.email?`${l.name} (${l.email})`:l.name})),value:p||"",onChange:l=>L("hostId",l,{shouldValidate:!0}),placeholder:c?j.length===0?"No team members":"Type to search host...":"Select company first",disabled:i||x||!c||j.length===0,error:(E=d.hostId)==null?void 0:E.message,emptyMessage:"No host found"}),d.hostId&&e.jsx("p",{className:"text-sm text-red-600 mt-1",children:d.hostId.message})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"scheduledDate",className:"block text-sm font-medium text-gray-700 mb-1",children:"Scheduled Date *"}),e.jsx("input",{...g("scheduledDate"),type:"datetime-local",id:"scheduledDate",min:G(),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",disabled:i}),d.scheduledDate&&e.jsx("p",{className:"text-sm text-red-600 mt-1",children:d.scheduledDate.message})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"purpose",className:"block text-sm font-medium text-gray-700 mb-1",children:"Purpose of Visit"}),e.jsx("input",{...g("purpose"),type:"text",id:"purpose",placeholder:"E.g., Business Meeting, Training, etc.",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",disabled:i}),d.purpose&&e.jsx("p",{className:"text-sm text-red-600 mt-1",children:d.purpose.message})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"notes",className:"block text-sm font-medium text-gray-700 mb-1",children:"Notes"}),e.jsx("textarea",{...g("notes"),id:"notes",placeholder:"Any additional notes",rows:3,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",disabled:i}),d.notes&&e.jsx("p",{className:"text-sm text-red-600 mt-1",children:d.notes.message})]}),e.jsx("button",{type:"submit",disabled:i,className:"w-full px-4 py-2 bg-blue-600 text-white rounded-lg font-medium hover:bg-blue-700 disabled:bg-gray-400 transition",children:i?"Saving...":s?"Update Registration":"Create Registration"})]})}const Ne=async t=>{const s=new URLSearchParams;t!=null&&t.page&&s.append("page",t.page.toString()),t!=null&&t.limit&&s.append("limit",t.limit.toString()),t!=null&&t.search&&s.append("search",t.search),t!=null&&t.status&&s.append("status",t.status),t!=null&&t.sortBy&&s.append("sortBy",t.sortBy),t!=null&&t.sortOrder&&s.append("sortOrder",t.sortOrder);const o=s.toString(),i=`/admin/api/pre-registrations${o?`?${o}`:""}`;return await V.get(i)},we=async t=>await V.post("/admin/api/pre-registrations",t),Pe=async(t,s)=>await V.put(`/admin/api/pre-registrations/${t}`,s),Se=async t=>await V.delete(`/admin/api/pre-registrations/${t}`),ke=async t=>await V.post(`/admin/api/pre-registrations/${t}/approve`,{}),Ce=async(t,s)=>await V.post(`/admin/api/pre-registrations/${t}/reject`,{reason:s}),Ee=async t=>await V.post(`/admin/api/pre-registrations/${t}/re-approve`,{}),U=t=>({PENDING:"bg-yellow-100 text-yellow-800",PENDING_APPROVAL:"bg-yellow-100 text-yellow-800",REJECTED:"bg-red-100 text-red-800",APPROVED:"bg-green-100 text-green-800",CHECKED_IN:"bg-blue-100 text-blue-800",CHECKED_OUT:"bg-gray-100 text-gray-800"})[t]||"bg-gray-100 text-gray-800",q=t=>({PENDING:"Pending",PENDING_APPROVAL:"Pending Approval",REJECTED:"Rejected",APPROVED:"Approved",CHECKED_IN:"Checked In",CHECKED_OUT:"Checked Out"})[t]||t,Ae=["PENDING_APPROVAL","REJECTED","APPROVED"];function Me({preRegistrations:t,isLoading:s,pagination:o,onSearch:i,onStatusFilter:x,onPageChange:c,onEdit:v,onDelete:F,onApprove:j,onReject:g,onReApprove:P,onQr:d}){const{user:m}=J(),L=(m==null?void 0:m.role)==="ADMIN",T=(m==null?void 0:m.role)==="ADMIN"||(m==null?void 0:m.role)==="RECEPTION",p=(m==null?void 0:m.role)!=="RECEPTION",[S,k]=a.useState(""),[R,C]=a.useState(""),E=r=>{const h=r.target.value;k(h),i(h)},l=r=>{C(r),x(r)},y=()=>{o.page>1&&c(o.page-1)},D=()=>{o.page<o.totalPages&&c(o.page+1)},_=r=>r.status==="PENDING_APPROVAL",$=r=>r.status==="PENDING_APPROVAL",A=r=>r.status==="REJECTED";return e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200",children:[e.jsxs("div",{className:"p-6 border-b border-gray-200 space-y-4",children:[e.jsx("div",{children:e.jsx("input",{type:"text",placeholder:"Search by name, email, phone, or purpose...",value:S,onChange:E,className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"})}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Filter by Status"}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsx("button",{onClick:()=>l(""),className:`px-3 py-1 rounded-full text-sm font-medium transition ${R===""?"bg-blue-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:"All"}),Ae.map(r=>e.jsx("button",{onClick:()=>l(r),className:`px-3 py-1 rounded-full text-sm font-medium transition ${R===r?"bg-blue-600 text-white":`${U(r)} hover:opacity-80`}`,children:q(r)},r))]})]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50 border-b border-gray-200",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-sm font-semibold text-gray-700",children:"Visitor Name"}),e.jsx("th",{className:"px-6 py-3 text-left text-sm font-semibold text-gray-700",children:"Contact"}),e.jsx("th",{className:"px-6 py-3 text-left text-sm font-semibold text-gray-700",children:"Host"}),e.jsx("th",{className:"px-6 py-3 text-left text-sm font-semibold text-gray-700",children:"Scheduled Date"}),e.jsx("th",{className:"px-6 py-3 text-left text-sm font-semibold text-gray-700",children:"Status"}),e.jsx("th",{className:"px-6 py-3 text-left text-sm font-semibold text-gray-700",children:"Actions"})]})}),e.jsx("tbody",{children:s?e.jsx("tr",{children:e.jsx("td",{colSpan:6,className:"px-6 py-8 text-center text-gray-500",children:e.jsx("div",{className:"flex items-center justify-center",children:e.jsx("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-blue-600"})})})}):t.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:6,className:"px-6 py-8 text-center text-gray-500",children:"No pre-registrations found."})}):t.map(r=>{var h;return e.jsxs("tr",{className:"border-b border-gray-200 hover:bg-gray-50 transition",children:[e.jsx("td",{className:"px-6 py-4 text-sm text-gray-900 font-medium",children:r.visitorName}),e.jsxs("td",{className:"px-6 py-4 text-sm text-gray-600",children:[e.jsx("div",{children:r.visitorPhone||"—"}),e.jsx("div",{className:"text-xs text-gray-500",children:r.visitorEmail||"—"})]}),e.jsx("td",{className:"px-6 py-4 text-sm text-gray-600",children:((h=r.host)==null?void 0:h.name)||"—"}),e.jsx("td",{className:"px-6 py-4 text-sm text-gray-600",children:r.expectedDate?e.jsxs(e.Fragment,{children:[new Date(r.expectedDate).toLocaleDateString()," at"," ",new Date(r.expectedDate).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})]}):"—"}),e.jsx("td",{className:"px-6 py-4 text-sm",children:e.jsx("span",{className:`inline-block px-2 py-1 rounded-full text-xs font-medium ${U(r.status)}`,children:q(r.status)})}),e.jsxs("td",{className:"px-6 py-4 text-sm space-x-1",children:[p&&_(r)&&j&&e.jsx("button",{onClick:()=>j(r),className:"inline-flex items-center p-2 rounded-lg text-green-600 hover:bg-green-50 transition",title:"Approve",children:e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2.5,d:"M5 13l4 4L19 7"})})}),p&&$(r)&&g&&e.jsx("button",{onClick:()=>g(r),className:"inline-flex items-center p-2 rounded-lg text-red-600 hover:bg-red-50 transition",title:"Reject",children:e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2.5,d:"M6 18L18 6M6 6l12 12"})})}),p&&A(r)&&P&&e.jsx("button",{onClick:()=>P(r),className:"inline-flex items-center p-2 rounded-lg text-blue-600 hover:bg-blue-50 transition",title:"Re-Approve",children:e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2.5,d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})})}),r.status==="APPROVED"&&d&&e.jsx("button",{onClick:()=>d(r),className:"inline-flex items-center p-2 rounded-lg text-indigo-600 hover:bg-indigo-50 transition",title:"QR Code",children:e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2.5,d:"M12 4v1m6 11h2m-6 0h-2v4m0-11v3m0 0h.01M12 12h4.01M16 20h4M4 12h4m12 0h.01M5 8h2a1 1 0 001-1V5a1 1 0 00-1-1H5a1 1 0 00-1 1v2a1 1 0 001 1zm12 0h2a1 1 0 001-1V5a1 1 0 00-1-1h-2a1 1 0 00-1 1v2a1 1 0 001 1zM5 20h2a1 1 0 001-1v-2a1 1 0 00-1-1H5a1 1 0 00-1 1v2a1 1 0 001 1z"})})}),T&&e.jsx("button",{onClick:()=>v(r),className:"inline-flex items-center p-2 rounded-lg text-blue-600 hover:bg-blue-50 transition",title:"Edit",children:e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2.5,d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})})}),L&&e.jsx("button",{onClick:()=>F(r),className:"inline-flex items-center p-2 rounded-lg text-red-600 hover:bg-red-50 transition",title:"Delete",children:e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2.5,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})})]})]},r.id)})})]})}),!s&&t.length>0&&e.jsxs("div",{className:"px-6 py-4 border-t border-gray-200 flex items-center justify-between",children:[e.jsxs("div",{className:"text-sm text-gray-600",children:["Showing ",(o.page-1)*o.limit+1," to"," ",Math.min(o.page*o.limit,o.total)," of"," ",o.total," pre-registrations"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:y,disabled:o.page===1,className:"px-3 py-1 border border-gray-300 rounded-lg text-sm font-medium text-gray-700 hover:bg-gray-50 disabled:text-gray-400 disabled:cursor-not-allowed transition",children:"Previous"}),e.jsx("div",{className:"flex items-center gap-1",children:(()=>{const r=o.page,h=o.totalPages,N=[];if(h<=7)for(let u=1;u<=h;u++)N.push(u);else{N.push(1),r>3&&N.push("...");for(let u=Math.max(2,r-1);u<=Math.min(h-1,r+1);u++)N.push(u);r<h-2&&N.push("..."),N.push(h)}return N.map((u,b)=>u==="..."?e.jsx("span",{className:"px-2 py-1 text-sm text-gray-500",children:"..."},`dots-${b}`):e.jsx("button",{onClick:()=>c(u),className:`px-3 py-1 rounded-lg text-sm font-medium transition ${u===r?"bg-blue-600 text-white":"border border-gray-300 text-gray-700 hover:bg-gray-50"}`,children:u},u))})()}),e.jsx("button",{onClick:D,disabled:o.page===o.totalPages,className:"px-3 py-1 border border-gray-300 rounded-lg text-sm font-medium text-gray-700 hover:bg-gray-50 disabled:text-gray-400 disabled:cursor-not-allowed transition",children:"Next"})]})]})]})}function Ie({isOpen:t,onClose:s,onSubmit:o,preRegistrationData:i,hosts:x,isLoading:c,isLoadingHosts:v}){return a.useEffect(()=>(t?document.body.style.overflow="hidden":document.body.style.overflow="auto",()=>{document.body.style.overflow="auto"}),[t]),t?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-40",onClick:s}),e.jsx("div",{className:"fixed inset-0 flex items-center justify-center z-50 p-4 overflow-y-auto",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-lg max-w-md w-full my-8",children:[e.jsxs("div",{className:"flex items-center justify-between px-6 py-4 border-b border-gray-200",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:i?"Edit Pre-Registration":"Create Pre-Registration"}),e.jsx("button",{onClick:s,className:"text-gray-500 hover:text-gray-700","aria-label":"Close",children:e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsx("div",{className:"px-6 py-4",children:e.jsx(je,{onSubmit:o,initialData:i,hosts:x,isLoading:c,isLoadingHosts:v})})]})})]}):null}function Fe({isOpen:t,preRegistration:s,onConfirm:o,onCancel:i,isLoading:x}){return a.useEffect(()=>(t?document.body.style.overflow="hidden":document.body.style.overflow="auto",()=>{document.body.style.overflow="auto"}),[t]),!t||!s?null:e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-40",onClick:i}),e.jsx("div",{className:"fixed inset-0 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-lg max-w-sm w-full",children:[e.jsx("div",{className:"flex justify-center py-6",children:e.jsx("div",{className:"flex items-center justify-center w-12 h-12 rounded-full bg-red-100",children:e.jsx("svg",{className:"w-6 h-6 text-red-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})})}),e.jsxs("div",{className:"text-center px-6 pb-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"Delete Pre-Registration"}),e.jsxs("p",{className:"text-gray-600 mb-2",children:["Are you sure you want to delete ",e.jsx("span",{className:"font-medium",children:s.visitorName}),"'s pre-registration record?"]}),e.jsx("p",{className:"text-sm text-gray-500",children:"This action cannot be undone."})]}),e.jsxs("div",{className:"flex gap-2 px-6 py-4 border-t border-gray-200 bg-gray-50 rounded-b-lg",children:[e.jsx("button",{onClick:i,disabled:x,className:"flex-1 px-4 py-2 border border-gray-300 rounded-lg text-sm font-medium text-gray-700 hover:bg-white disabled:bg-gray-100 transition",children:"Cancel"}),e.jsx("button",{onClick:o,disabled:x,className:"flex-1 px-4 py-2 bg-red-600 text-white rounded-lg text-sm font-medium hover:bg-red-700 disabled:bg-gray-400 transition",children:x?"Deleting...":"Delete"})]})]})})]})}function Te(){const{success:t,error:s}=pe(),{user:o}=J(),i=(o==null?void 0:o.role)==="ADMIN"||(o==null?void 0:o.role)==="RECEPTION",[x,c]=a.useState([]),[v,F]=a.useState([]),[j,g]=a.useState(!1),[P,d]=a.useState(null),[m,L]=a.useState(!1),[T,p]=a.useState(!1),[S,k]=a.useState(),[R,C]=a.useState(!1),[E,l]=a.useState(),[y,D]=a.useState(!1),[_,$]=a.useState(!1),[,A]=a.useState(!1),[r,h]=a.useState(null),[N,u]=a.useState(!1),[b,K]=a.useState({page:1,limit:10,total:0,totalPages:1}),[M,X]=a.useState(""),[I,Y]=a.useState(""),z=a.useCallback(async()=>{L(!0);try{const n=await be({limit:1e3});F(n.data||[])}catch{s("Failed to load hosts")}finally{L(!1)}},[s]),f=a.useCallback(async(n=1,w="",H="")=>{g(!0),d(null);try{const Q={page:n,limit:b.limit};w&&(Q.search=w),H&&(Q.status=H);const B=await Ne(Q);c(B.data||[]),K({page:B.page||1,limit:B.limit||10,total:B.total||0,totalPages:B.totalPages||1})}catch{d("Failed to load pre-registrations. Please check your connection and try again."),s("Failed to load pre-registrations")}finally{g(!1)}},[b.limit,s]);a.useEffect(()=>{z(),f(1,"","")},[z,f]);const Z=n=>{X(n),f(1,n,I)},ee=n=>{Y(n),f(1,M,n)},te=n=>{f(n,M,I)},se=async n=>{$(!0);try{S?(await Pe(S.id,n),t("Pre-registration updated successfully")):(await we(n),t("Pre-registration created successfully")),p(!1),k(void 0),await f(b.page,M,I)}catch{s(S?"Failed to update pre-registration":"Failed to create pre-registration")}finally{$(!1)}},re=async n=>{A(!0);try{await ke(n.id),t("Pre-registration approved successfully"),await f(b.page,M,I)}catch{s("Failed to approve pre-registration")}finally{A(!1)}},oe=async n=>{A(!0);try{await Ce(n.id),t("Pre-registration rejected"),await f(b.page,M,I)}catch{s("Failed to reject pre-registration")}finally{A(!1)}},ne=async n=>{A(!0);try{await Ee(n.id),t("Pre-registration re-approved successfully"),await f(b.page,M,I)}catch{s("Failed to re-approve pre-registration")}finally{A(!1)}},le=n=>{var w,H;h({id:n.id,sessionId:"",visitorName:n.visitorName,visitorCompany:n.visitorCompany,visitorPhone:n.visitorPhone||"",visitorEmail:n.visitorEmail,hostName:((w=n.host)==null?void 0:w.name)||"",hostCompany:((H=n.host)==null?void 0:H.company)||"",purpose:n.purpose||"",checkInAt:""}),u(!0)},ae=async()=>{if(E){D(!0);try{await Se(E.id),t("Pre-registration deleted successfully"),C(!1),l(void 0),await f(b.page,M,I)}catch{s("Failed to delete pre-registration")}finally{D(!1)}}},ie=n=>{k(n),p(!0)},de=n=>{l(n),C(!0)},ce=()=>{p(!1),k(void 0)};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Pre-Registrations Management"}),e.jsx("p",{className:"text-gray-600 mt-1",children:"Manage pre-registered visitor records and approvals"})]}),i&&e.jsx("button",{onClick:()=>{k(void 0),p(!0)},className:"px-4 py-2 bg-blue-600 text-white rounded-lg font-medium hover:bg-blue-700 transition",children:e.jsxs("span",{className:"inline-flex items-center gap-2",children:[e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})}),"Add Pre-Registration"]})})]}),P&&!j&&e.jsx(ye,{title:"Failed to load pre-registrations",message:P,onRetry:()=>f(b.page,M,I)}),!P&&e.jsx(Me,{preRegistrations:x,isLoading:j,pagination:b,onSearch:Z,onStatusFilter:ee,onPageChange:te,onEdit:ie,onDelete:de,onApprove:re,onReject:oe,onReApprove:ne,onQr:le}),e.jsx(Ie,{isOpen:T,onClose:ce,onSubmit:se,preRegistrationData:S,hosts:v,isLoading:_,isLoadingHosts:m}),e.jsx(ge,{visitor:r,isOpen:N,onClose:()=>{u(!1),h(null)}}),e.jsx(Fe,{isOpen:R,preRegistration:E,onConfirm:ae,onCancel:()=>{C(!1),l(void 0)},isLoading:y})]})}export{Te as default};
