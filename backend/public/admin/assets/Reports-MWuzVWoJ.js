import{r as p,j as e,b as L,u as V}from"./index-qtKvTnmP.js";import{E}from"./ErrorState-DxM79iVM.js";function T({onDateRangeChange:n,isLoading:a}){const[s,r]=p.useState(()=>{const t=new Date;return t.setDate(t.getDate()-30),t.toISOString().split("T")[0]}),[i,c]=p.useState(()=>new Date().toISOString().split("T")[0]),o=()=>{s&&i&&n(s,i)},d=t=>{const u=new Date,g=new Date;g.setDate(u.getDate()-t);const m=g.toISOString().split("T")[0],b=u.toISOString().split("T")[0];r(m),c(b),n(m,b)};return e.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{children:e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Select Date Range"})}),e.jsxs("div",{className:"flex flex-wrap gap-2 mb-4",children:[e.jsx("button",{onClick:()=>d(7),disabled:a,className:"px-3 py-2 text-sm font-medium text-gray-700 bg-gray-100 rounded-lg hover:bg-gray-200 disabled:opacity-50 transition",children:"Last 7 Days"}),e.jsx("button",{onClick:()=>d(30),disabled:a,className:"px-3 py-2 text-sm font-medium text-gray-700 bg-gray-100 rounded-lg hover:bg-gray-200 disabled:opacity-50 transition",children:"Last 30 Days"}),e.jsx("button",{onClick:()=>d(90),disabled:a,className:"px-3 py-2 text-sm font-medium text-gray-700 bg-gray-100 rounded-lg hover:bg-gray-200 disabled:opacity-50 transition",children:"Last 90 Days"}),e.jsx("button",{onClick:()=>d(365),disabled:a,className:"px-3 py-2 text-sm font-medium text-gray-700 bg-gray-100 rounded-lg hover:bg-gray-200 disabled:opacity-50 transition",children:"Last Year"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"startDate",className:"block text-sm font-medium text-gray-700 mb-2",children:"Start Date"}),e.jsx("input",{type:"date",id:"startDate",value:s,onChange:t=>r(t.target.value),disabled:a,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"endDate",className:"block text-sm font-medium text-gray-700 mb-2",children:"End Date"}),e.jsx("input",{type:"date",id:"endDate",value:i,onChange:t=>c(t.target.value),disabled:a,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"})]})]}),e.jsx("button",{onClick:o,disabled:a,className:"w-full px-4 py-2 bg-blue-600 text-white rounded-lg font-medium hover:bg-blue-700 disabled:bg-gray-400 transition",children:a?"Loading...":"Apply"})]})})}const M={blue:"bg-blue-50 text-blue-600 border-blue-200",green:"bg-green-50 text-green-600 border-green-200",orange:"bg-orange-50 text-orange-600 border-orange-200",red:"bg-red-50 text-red-600 border-red-200",purple:"bg-purple-50 text-purple-600 border-purple-200"},$={blue:"bg-blue-100",green:"bg-green-100",orange:"bg-orange-100",red:"bg-red-100",purple:"bg-purple-100"};function h({title:n,value:a,icon:s,color:r,isLoading:i}){return e.jsx("div",{className:`rounded-lg border p-6 ${M[r]}`,children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-sm font-medium opacity-75",children:n}),i?e.jsx("div",{className:"mt-2 h-8 w-24 animate-pulse rounded bg-current opacity-25"}):e.jsx("p",{className:"mt-2 text-3xl font-bold",children:a})]}),e.jsx("div",{className:`rounded-lg p-3 ${$[r]}`,children:s})]})})}function y({title:n,columns:a,data:s,isLoading:r,onExport:i}){const c={left:"text-left",center:"text-center",right:"text-right"};return e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200",children:[e.jsxs("div",{className:"flex items-center justify-between px-6 py-4 border-b border-gray-200",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:n}),i&&e.jsxs("button",{onClick:i,disabled:r,className:"inline-flex items-center gap-2 px-3 py-2 text-sm font-medium text-blue-600 hover:bg-blue-50 rounded-lg disabled:opacity-50 transition",children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 16.5V9.75m0 0l3 3m-3-3l-3 3M6.75 19.5a4.5 4.5 0 01-1.41-8.775 5.25 5.25 0 0110.233-2.33A3 3 0 0116.5 19.5H6.75z"})}),"Export"]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50 border-b border-gray-200",children:e.jsx("tr",{children:a.map(o=>e.jsx("th",{className:`px-6 py-3 text-sm font-semibold text-gray-700 ${c[o.align||"left"]}`,children:o.label},o.key))})}),e.jsx("tbody",{children:r?e.jsx("tr",{children:e.jsx("td",{colSpan:a.length,className:"px-6 py-8 text-center text-gray-500",children:e.jsx("div",{className:"flex items-center justify-center",children:e.jsx("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-blue-600"})})})}):s.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:a.length,className:"px-6 py-8 text-center text-gray-500",children:"No data available for this period."})}):s.map((o,d)=>e.jsx("tr",{className:"border-b border-gray-200 hover:bg-gray-50 transition",children:a.map(t=>e.jsx("td",{className:`px-6 py-4 text-sm text-gray-600 ${c[t.align||"left"]}`,children:t.format?t.format(o[t.key]):o[t.key]},t.key))},d))})]})})]})}function v({title:n,data:a,isLoading:s,maxValue:r}){const i=r||Math.max(...a.map(d=>d.value),0),c=i>0?100/i:1,o=["bg-blue-500","bg-green-500","bg-orange-500","bg-red-500","bg-purple-500","bg-pink-500","bg-indigo-500","bg-teal-500"];return e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-6",children:n}),s?e.jsx("div",{className:"space-y-4",children:[...Array(5)].map((d,t)=>e.jsx("div",{className:"h-8 bg-gray-200 rounded animate-pulse"},t))}):a.length===0?e.jsx("div",{className:"text-center py-12 text-gray-500",children:"No data available"}):e.jsx("div",{className:"space-y-6",children:a.map((d,t)=>e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-end justify-between mb-2",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700",children:d.label}),e.jsx("span",{className:"text-sm font-semibold text-gray-900",children:d.value})]}),e.jsx("div",{className:"w-full h-8 bg-gray-100 rounded-full overflow-hidden",children:e.jsx("div",{className:`h-full transition-all duration-500 ${d.color||o[t%o.length]}`,style:{width:`${d.value*c}%`}})})]},t))})]})}const A=async n=>{const a=new URLSearchParams({startDate:n.startDate,endDate:n.endDate});return await L.get(`/admin/api/reports?${a.toString()}`)},I=async(n,a="csv")=>{const s=new URLSearchParams({startDate:n.startDate,endDate:n.endDate,format:a}),r=localStorage.getItem("auth_token"),i=await fetch(`/admin/api/reports/visits/export?${s.toString()}`,{method:"GET",headers:{...r&&{Authorization:`Bearer ${r}`}}});if(!i.ok)throw new Error("Failed to export report");return i.blob()},P=async(n,a="csv")=>{const s=new URLSearchParams({startDate:n.startDate,endDate:n.endDate,format:a}),r=localStorage.getItem("auth_token"),i=await fetch(`/admin/api/reports/deliveries/export?${s.toString()}`,{method:"GET",headers:{...r&&{Authorization:`Bearer ${r}`}}});if(!i.ok)throw new Error("Failed to export report");return i.blob()},f=(n,a)=>{const s=window.URL.createObjectURL(n),r=document.createElement("a");r.href=s,r.download=a,document.body.appendChild(r),r.click(),document.body.removeChild(r),window.URL.revokeObjectURL(s)};function z(){const{success:n,error:a}=V(),[s,r]=p.useState(!1),[i,c]=p.useState(null),[o,d]=p.useState({summary:{totalVisits:0,approvedVisits:0,checkedInVisits:0,totalDeliveries:0,deliveriesPickedUp:0,activeHosts:0},visitReports:[],deliveryReports:[],hostReports:[]}),[t,u]=p.useState(()=>{const l=new Date,x=new Date;return x.setDate(l.getDate()-30),{startDate:x.toISOString().split("T")[0],endDate:l.toISOString().split("T")[0]}}),g=p.useCallback(async(l,x)=>{r(!0),c(null);try{const j=await A({startDate:l,endDate:x});d(j)}catch{c("Failed to load reports. Please check your connection and try again."),a("Failed to load reports")}finally{r(!1)}},[a]);p.useEffect(()=>{g(t.startDate,t.endDate)},[g,t.startDate,t.endDate]);const m=(l,x)=>{u({startDate:l,endDate:x}),g(l,x)},b=async()=>{try{const l=await I(t,"csv");f(l,`visit-report-${t.startDate}-${t.endDate}.csv`),n("Visit report exported successfully")}catch{a("Failed to export visit report")}},D=async()=>{try{const l=await P(t,"csv");f(l,`delivery-report-${t.startDate}-${t.endDate}.csv`),n("Delivery report exported successfully")}catch{a("Failed to export delivery report")}},k=o.visitReports.map(l=>({label:new Date(l.date).toLocaleDateString(),value:l.totalVisits,color:"bg-blue-500"})),N=o.deliveryReports.map(l=>({label:new Date(l.date).toLocaleDateString(),value:l.totalDeliveries,color:"bg-green-500"})),w=o.hostReports.slice(0,10).map(l=>({label:l.hostName,value:l.totalVisits})),S=[{key:"date",label:"Date",format:l=>new Date(l).toLocaleDateString()},{key:"totalVisits",label:"Total Visits"},{key:"approved",label:"Approved"},{key:"pending",label:"Pending"},{key:"checkedIn",label:"Checked In"},{key:"checkedOut",label:"Checked Out"},{key:"rejected",label:"Rejected"}],R=[{key:"date",label:"Date",format:l=>new Date(l).toLocaleDateString()},{key:"totalDeliveries",label:"Total Deliveries"},{key:"pickedUp",label:"Picked Up"},{key:"pending",label:"Awaiting Pickup"}],C=[{key:"hostName",label:"Host Name"},{key:"totalVisits",label:"Total Visits"}];return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Reports & Analytics"}),e.jsx("p",{className:"text-gray-600 mt-1",children:"Comprehensive analytics and reporting dashboard"})]}),e.jsx(T,{onDateRangeChange:m,isLoading:s}),i&&!s&&e.jsx(E,{title:"Failed to load reports",message:i,onRetry:()=>g(t.startDate,t.endDate)}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[e.jsx(h,{title:"Total Visits",value:o.summary.totalVisits,icon:e.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4.354a4 4 0 110 5.292M15 21H3v-2a6 6 0 0112 0v2zm0 0h6v-2a6 6 0 00-9-5.197M13 7a4 4 0 11-8 0 4 4 0 018 0z"})}),color:"blue",isLoading:s}),e.jsx(h,{title:"Approved Visits",value:o.summary.approvedVisits,icon:e.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})}),color:"green",isLoading:s}),e.jsx(h,{title:"Checked In",value:o.summary.checkedInVisits,icon:e.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M11 16l-4-4m0 0l4-4m-4 4h14m-5 4v2a2 2 0 01-2 2H7a2 2 0 01-2-2v-2m14-4V7a2 2 0 00-2-2h-6.343M11 20h1m-6-4h.01M5 11h.01"})}),color:"orange",isLoading:s}),e.jsx(h,{title:"Total Deliveries",value:o.summary.totalDeliveries,icon:e.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M20.354 15.354A9 9 0 015.646 5.646 9.003 9.003 0 0012 2c4.971 0 9.185 3.364 9.88 7.848.05.366.037.735-.009 1.102a5.002 5.002 0 01-3.782 3.75A5 5 0 1112 2z"})}),color:"purple",isLoading:s}),e.jsx(h,{title:"Picked Up",value:o.summary.deliveriesPickedUp,icon:e.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})}),color:"green",isLoading:s}),e.jsx(h,{title:"Active Hosts",value:o.summary.activeHosts,icon:e.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17 20h5v-2a3 3 0 00-5.856-1.487M15 10a3 3 0 11-6 0 3 3 0 016 0zM6 20a6 6 0 0112 0v2H6v-2z"})}),color:"red",isLoading:s})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsx(v,{title:"Daily Visit Trends",data:k,isLoading:s}),e.jsx(v,{title:"Daily Delivery Trends",data:N,isLoading:s})]}),e.jsx("div",{className:"grid grid-cols-1 gap-6",children:e.jsx(v,{title:"Top 10 Hosts by Visit Count",data:w,isLoading:s})}),e.jsxs("div",{className:"space-y-6",children:[e.jsx(y,{title:"Visit Report Details",columns:S,data:o.visitReports,isLoading:s,onExport:b}),e.jsx(y,{title:"Delivery Report Details",columns:R,data:o.deliveryReports,isLoading:s,onExport:D}),e.jsx(y,{title:"Host Activity Report",columns:C,data:o.hostReports,isLoading:s})]})]})}export{z as default};
