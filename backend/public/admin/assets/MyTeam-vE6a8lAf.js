import{b as y,a as U,u as G,r as o,j as t}from"./index-C4NMOT3W.js";import{H as J,a as K}from"./HostModal-D1U7dzR0.js";import{E as X}from"./ErrorState-p7UMj24u.js";import{H as Y}from"./HostLookup-B7diWl39.js";import{g as Z}from"./hosts-DoFqYo0X.js";const _=async e=>{const n=new URLSearchParams;e!=null&&e.page&&n.append("page",e.page.toString()),e!=null&&e.limit&&n.append("limit",e.limit.toString()),e!=null&&e.search&&n.append("search",e.search),(e==null?void 0:e.status)!==void 0&&n.append("status",e.status.toString()),e!=null&&e.hostId&&n.append("hostId",e.hostId);const l=n.toString(),u=`/admin/api/my-team${l?`?${l}`:""}`;return await y.get(u)},V=async e=>await y.post("/admin/api/my-team",e),ee=async(e,n)=>await y.patch(`/admin/api/my-team/${e}`,n),te=async(e,n)=>await y.patch(`/admin/api/my-team/${e}/status`,{status:n});function re(){const{user:e}=U(),{success:n,error:l}=G(),u=(e==null?void 0:e.role)==="HOST",r=(e==null?void 0:e.role)==="RECEPTION"||(e==null?void 0:e.role)==="ADMIN",[x,S]=o.useState([]),[E,j]=o.useState(!1),[v,M]=o.useState(null),[k,h]=o.useState(!1),[b,p]=o.useState(),[I,w]=o.useState(!1),[g,H]=o.useState({page:1,limit:10,total:0,totalPages:1}),[f,N]=o.useState(""),[c,P]=o.useState(null),[T,$]=o.useState(""),[C,A]=o.useState([]),[O,L]=o.useState(!1);o.useEffect(()=>{r&&(L(!0),Z({limit:500}).then(s=>{const a=(s.data||[]).filter(i=>i.status===1);A(a)}).catch(()=>l("Failed to load hosts")).finally(()=>L(!1)))},[r,l]);const F=u||c,d=o.useCallback(async(s=1,a="")=>{if(r&&!c){S([]);return}j(!0),M(null);try{const i={page:s,limit:g.limit,search:a};r&&c&&(i.hostId=c);const m=await _(i);S(m.data||[]),H({page:m.page,limit:m.limit,total:m.total,totalPages:m.totalPages})}catch(i){M(i instanceof Error?i.message:"Failed to load team members")}finally{j(!1)}},[g.limit,r,c]);o.useEffect(()=>{u&&d(1,"")},[u,d]),o.useEffect(()=>{r&&c&&(H(s=>({...s,page:1})),N(""),d(1,""))},[c,r,d]);const R=async s=>{if(r&&!c){l("Please select a host company first");return}w(!0);try{const a={...s};r&&c&&(a.hostId=c),b?(await ee(String(b.id),a),n("Team member updated successfully")):(await V(a),n("Team member created successfully")),h(!1),p(void 0),d(g.page,f)}catch(a){l(a instanceof Error?a.message:"Failed to save team member")}finally{w(!1)}},D=s=>{p(s),h(!0)},z=async s=>{const a=s.status===1?0:1,i=a===0?"deactivate":"reactivate";if(confirm(`Are you sure you want to ${i} ${s.name}?`))try{await te(String(s.id),a),n(`Team member ${i}d successfully`),d(g.page,f)}catch(m){l(m instanceof Error?m.message:`Failed to ${i} team member`)}},q=s=>{N(s),d(1,s)},B=s=>{d(s,f)},Q=()=>{h(!1),p(void 0)},W=s=>{const a=C.find(i=>String(i.id)===s);P(s||null),$((a==null?void 0:a.company)||"")};return t.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200",children:[t.jsx("div",{className:"px-6 py-4 border-b border-gray-200",children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{children:[t.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"My Team"}),t.jsx("p",{className:"mt-1 text-sm text-gray-500",children:u?"Manage your company's team members":T?`Managing team on behalf of: ${T}`:"Select a host company to manage their team members"})]}),t.jsxs("button",{onClick:()=>h(!0),disabled:r&&!c,className:"inline-flex items-center px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition disabled:opacity-50 disabled:cursor-not-allowed",children:[t.jsx("svg",{className:"w-5 h-5 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})}),"Add Team Member"]})]})}),r&&t.jsxs("div",{className:"px-6 py-4 border-b border-gray-200 bg-blue-50",children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Select Host Company *"}),t.jsx(Y,{hosts:C,value:c||"",onChange:W,isLoading:O})]}),E&&x.length===0?t.jsx("div",{className:"flex items-center justify-center py-12",children:t.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"})}):v?t.jsx(X,{message:v,onRetry:()=>d(1,f)}):F?t.jsx(J,{hosts:x,isLoading:!1,pagination:g,onSearch:q,onPageChange:B,onEdit:D,onDelete:()=>{},onToggleStatus:z,entityLabel:"team member",hideCompany:!0,showActions:!0}):t.jsxs("div",{className:"flex flex-col items-center justify-center py-16 px-6 text-center",children:[t.jsx("svg",{className:"w-16 h-16 text-gray-300 mb-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"})}),t.jsx("p",{className:"text-gray-500 text-lg font-medium",children:"No Host Company Selected"}),t.jsx("p",{className:"text-gray-400 text-sm mt-1",children:"Please select a host company above to manage their team members"})]}),t.jsx(K,{isOpen:k,onClose:Q,onSubmit:R,hostData:b,isLoading:I,entityLabel:"team member",hideCompany:!0})]})}export{re as default};
