import{r as a,c as ie,j as e,t as ce,o as de,s as L,l as me,b as R,a as ue,u as xe}from"./index-DhWX03Cy.js";import{g as he}from"./lookups-B1z8U9ad.js";import{S as _}from"./SearchableSelect-ClOu6u_R.js";import{Q as pe}from"./QrModal-D1uVr1n2.js";import{E as ge}from"./ErrorState-CQnIf7eq.js";import{g as ye}from"./hosts-r3Q6BTCa.js";function K(){const t=new Date;return t.setMinutes(t.getMinutes()-t.getTimezoneOffset()),t.toISOString().slice(0,16)}const fe=de({visitorName:L().min(2,"Visitor name must be at least 2 characters"),visitorEmail:L().email("Invalid email address").optional().or(me("")),visitorPhone:L().optional(),hostId:L().min(1,"Please select a host"),visitDate:L().min(1,"Visit date is required"),purpose:L().optional(),notes:L().optional()});function be(t){const s=new Set(t.map(r=>r.company).filter(Boolean));return Array.from(s).sort()}function ve({onSubmit:t,initialData:s,hosts:r,isLoading:d,isLoadingHosts:m}){var T,F,g;const[j,N]=a.useState([]),[M,w]=a.useState(!1),[x,C]=a.useState(""),S=a.useMemo(()=>{var o;const n=be(r);return(o=s==null?void 0:s.host)!=null&&o.company&&!n.includes(s.host.company)?[...n,s.host.company].sort():n},[r,(T=s==null?void 0:s.host)==null?void 0:T.company]),h=a.useMemo(()=>{if(!x)return[];const n=r.filter(o=>o.company===x);return s!=null&&s.host&&s.host.company===x&&!n.some(u=>String(u.id)===String(s.host.id))?[s.host,...n]:n},[r,x,s==null?void 0:s.host]);a.useEffect(()=>{w(!0),he().then(N).catch(()=>N([])).finally(()=>w(!1))},[]);const{register:p,handleSubmit:k,formState:{errors:i},reset:$,setValue:f,watch:V}=ie({resolver:ce(fe),defaultValues:s||{visitorName:"",visitorEmail:"",visitorPhone:"",hostId:"",visitDate:K(),purpose:"",notes:""}}),b=V("hostId");a.useEffect(()=>{if(b){const n=r.find(o=>String(o.id)===String(b))??(s==null?void 0:s.host);n!=null&&n.company&&C(n.company)}else C("")},[b,r,s==null?void 0:s.host]);const H=n=>{C(n),f("hostId","",{shouldValidate:!0})},O=async n=>{await t(n),$(),C("")};return e.jsxs("form",{onSubmit:k(O),className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"visitorName",className:"block text-sm font-medium text-gray-700 mb-1",children:"Visitor Name *"}),e.jsx("input",{...p("visitorName"),type:"text",id:"visitorName",placeholder:"Enter visitor name",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",disabled:d}),i.visitorName&&e.jsx("p",{className:"text-sm text-red-600 mt-1",children:i.visitorName.message})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"visitorEmail",className:"block text-sm font-medium text-gray-700 mb-1",children:"Email"}),e.jsx("input",{...p("visitorEmail"),type:"email",id:"visitorEmail",placeholder:"Enter email address",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",disabled:d}),i.visitorEmail&&e.jsx("p",{className:"text-sm text-red-600 mt-1",children:i.visitorEmail.message})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"visitorPhone",className:"block text-sm font-medium text-gray-700 mb-1",children:"Phone"}),e.jsx("input",{...p("visitorPhone"),type:"tel",id:"visitorPhone",placeholder:"Enter phone number",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",disabled:d}),i.visitorPhone&&e.jsx("p",{className:"text-sm text-red-600 mt-1",children:i.visitorPhone.message})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"hostCompany",className:"block text-sm font-medium text-gray-700 mb-1",children:"Company *"}),e.jsx(_,{options:S.map(n=>({value:n,label:n})),value:x,onChange:H,placeholder:m?"Loading companies...":S.length===0?"No companies":"Type to search company...",disabled:d||m||S.length===0,isLoading:m,error:!x&&typeof((F=i.hostId)==null?void 0:F.message)=="string"?i.hostId.message:void 0,emptyMessage:"No company found"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"hostId",className:"block text-sm font-medium text-gray-700 mb-1",children:"Host / Contact Person *"}),e.jsx(_,{options:h.map(n=>({value:String(n.id),label:n.email?`${n.name} (${n.email})`:n.name})),value:b||"",onChange:n=>f("hostId",n,{shouldValidate:!0}),placeholder:x?h.length===0?"No team members":"Type to search host / contact...":"Select company first",disabled:d||m||!x||h.length===0,error:typeof((g=i.hostId)==null?void 0:g.message)=="string"?i.hostId.message:void 0,emptyMessage:"No host found"}),i.hostId&&e.jsx("p",{className:"text-sm text-red-600 mt-1",children:i.hostId.message})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"visitDate",className:"block text-sm font-medium text-gray-700 mb-1",children:"Visit Date *"}),e.jsx("input",{...p("visitDate"),type:"datetime-local",id:"visitDate",min:K(),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",disabled:d}),i.visitDate&&e.jsx("p",{className:"text-sm text-red-600 mt-1",children:i.visitDate.message})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"purpose",className:"block text-sm font-medium text-gray-700 mb-1",children:"Purpose of Visit"}),e.jsx(_,{options:[{value:"",label:"— None —"},...j.map(n=>({value:n.label,label:n.label}))],value:V("purpose")||"",onChange:n=>f("purpose",n,{shouldValidate:!0}),placeholder:M?"Loading purposes...":"Type to search purpose...",disabled:d||M,emptyMessage:"No purpose found"}),i.purpose&&e.jsx("p",{className:"text-sm text-red-600 mt-1",children:i.purpose.message})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"notes",className:"block text-sm font-medium text-gray-700 mb-1",children:"Notes"}),e.jsx("textarea",{...p("notes"),id:"notes",placeholder:"Any additional notes",rows:3,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",disabled:d}),i.notes&&e.jsx("p",{className:"text-sm text-red-600 mt-1",children:i.notes.message})]}),e.jsx("button",{type:"submit",disabled:d,className:"w-full px-4 py-2 bg-blue-600 text-white rounded-lg font-medium hover:bg-blue-700 disabled:bg-gray-400 transition",children:d?"Saving...":s?"Update Visit":"Create Visit"})]})}const je=async t=>{const s=new URLSearchParams;t!=null&&t.page&&s.append("page",t.page.toString()),t!=null&&t.limit&&s.append("limit",t.limit.toString()),t!=null&&t.search&&s.append("search",t.search),t!=null&&t.status&&s.append("status",t.status),t!=null&&t.sortBy&&s.append("sortBy",t.sortBy),t!=null&&t.sortOrder&&s.append("sortOrder",t.sortOrder);const r=s.toString(),d=`/admin/api/visitors${r?`?${r}`:""}`;return await R.get(d)},Ne=async t=>await R.post("/admin/api/visitors",t),we=async(t,s)=>await R.put(`/admin/api/visitors/${t}`,s),Ce=async t=>await R.delete(`/admin/api/visitors/${t}`),Se=async t=>await R.post(`/admin/api/visitors/${t}/approve`,{}),ke=async(t,s)=>await R.post(`/admin/api/visitors/${t}/reject`,{reason:s}),Ee=async t=>await R.post(`/admin/api/visitors/${t}/checkout`,{}),W=t=>({PENDING:"bg-yellow-100 text-yellow-800",PENDING_APPROVAL:"bg-yellow-100 text-yellow-800",APPROVED:"bg-green-100 text-green-800",CHECKED_IN:"bg-blue-100 text-blue-800",CHECKED_OUT:"bg-gray-100 text-gray-800",REJECTED:"bg-red-100 text-red-800"})[t]||"bg-gray-100 text-gray-800",G=t=>({PENDING:"Pending",PENDING_APPROVAL:"Pending Approval",APPROVED:"Approved",CHECKED_IN:"Checked In",CHECKED_OUT:"Checked Out",REJECTED:"Rejected"})[t]||t,Ve=["APPROVED","CHECKED_IN","CHECKED_OUT"];function Pe({visitors:t,isLoading:s,pagination:r,onSearch:d,onStatusFilter:m,onPageChange:j,onEdit:N,onDelete:M,onApprove:w,onReject:x,onCheckout:C,onQr:S}){const{user:h}=ue(),p=(h==null?void 0:h.role)==="ADMIN",k=(h==null?void 0:h.role)!=="RECEPTION",[i,$]=a.useState(""),[f,V]=a.useState(""),b=o=>{const u=o.target.value;$(u),d(u)},H=o=>{V(o),m(o)},O=()=>{r.page>1&&j(r.page-1)},T=()=>{r.page<r.totalPages&&j(r.page+1)},F=o=>o.status==="PENDING",g=o=>o.status==="PENDING",n=o=>o.status==="CHECKED_IN";return e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200",children:[e.jsxs("div",{className:"p-6 border-b border-gray-200 space-y-4",children:[e.jsx("div",{children:e.jsx("input",{type:"text",placeholder:"Search by name, email, phone, or purpose...",value:i,onChange:b,className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"})}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Filter by Status"}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsx("button",{onClick:()=>H(""),className:`px-3 py-1 rounded-full text-sm font-medium transition ${f===""?"bg-blue-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:"All"}),Ve.map(o=>e.jsx("button",{onClick:()=>H(o),className:`px-3 py-1 rounded-full text-sm font-medium transition ${f===o?"bg-blue-600 text-white":`${W(o)} hover:opacity-80`}`,children:G(o)},o))]})]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50 border-b border-gray-200",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-sm font-semibold text-gray-700",children:"Visitor Name"}),e.jsx("th",{className:"px-6 py-3 text-left text-sm font-semibold text-gray-700",children:"Contact"}),e.jsx("th",{className:"px-6 py-3 text-left text-sm font-semibold text-gray-700",children:"Host"}),e.jsx("th",{className:"px-6 py-3 text-left text-sm font-semibold text-gray-700",children:"Purpose"}),e.jsx("th",{className:"px-6 py-3 text-left text-sm font-semibold text-gray-700",children:"Status"}),e.jsx("th",{className:"px-6 py-3 text-left text-sm font-semibold text-gray-700",children:"Actions"})]})}),e.jsx("tbody",{children:s?e.jsx("tr",{children:e.jsx("td",{colSpan:6,className:"px-6 py-8 text-center text-gray-500",children:e.jsx("div",{className:"flex items-center justify-center",children:e.jsx("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-blue-600"})})})}):t.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:6,className:"px-6 py-8 text-center text-gray-500",children:"No visitors found."})}):t.map(o=>{var u;return e.jsxs("tr",{className:"border-b border-gray-200 hover:bg-gray-50 transition",children:[e.jsx("td",{className:"px-6 py-4 text-sm text-gray-900 font-medium",children:o.visitorName}),e.jsxs("td",{className:"px-6 py-4 text-sm text-gray-600",children:[e.jsx("div",{children:o.visitorPhone||"—"}),e.jsx("div",{className:"text-xs text-gray-500",children:o.visitorEmail||"—"})]}),e.jsx("td",{className:"px-6 py-4 text-sm text-gray-600",children:((u=o.host)==null?void 0:u.name)||"—"}),e.jsx("td",{className:"px-6 py-4 text-sm text-gray-600",children:o.purpose||"—"}),e.jsx("td",{className:"px-6 py-4 text-sm",children:e.jsx("span",{className:`inline-block px-2 py-1 rounded-full text-xs font-medium ${W(o.status)}`,children:G(o.status)})}),e.jsxs("td",{className:"px-6 py-4 text-sm space-x-1",children:[k&&F(o)&&w&&e.jsx("button",{onClick:()=>w(o),className:"inline-flex items-center px-2 py-1 rounded-md text-xs font-medium text-green-600 hover:bg-green-50 transition",children:"Approve"}),k&&g(o)&&x&&e.jsx("button",{onClick:()=>x(o),className:"inline-flex items-center px-2 py-1 rounded-md text-xs font-medium text-red-600 hover:bg-red-50 transition",children:"Reject"}),(o.status==="APPROVED"||o.status==="CHECKED_IN")&&S&&e.jsx("button",{onClick:()=>S(o),className:"inline-flex items-center p-1.5 rounded-md text-indigo-600 hover:bg-indigo-50 transition",title:"QR Code",children:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v1m6 11h2m-6 0h-2v4m0-11v3m0 0h.01M12 12h4.01M16 20h4M4 12h4m12 0h.01M5 8h2a1 1 0 001-1V5a1 1 0 00-1-1H5a1 1 0 00-1 1v2a1 1 0 001 1zm12 0h2a1 1 0 001-1V5a1 1 0 00-1-1h-2a1 1 0 00-1 1v2a1 1 0 001 1zM5 20h2a1 1 0 001-1v-2a1 1 0 00-1-1H5a1 1 0 00-1 1v2a1 1 0 001 1z"})})}),n(o)&&C&&e.jsx("button",{onClick:()=>C(o),className:"inline-flex items-center p-1.5 rounded-md text-orange-600 hover:bg-orange-50 transition",title:"Checkout",children:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"})})}),e.jsx("button",{onClick:()=>N(o),className:"inline-flex items-center p-1.5 rounded-md text-blue-600 hover:bg-blue-50 transition",title:"Edit",children:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})})}),p&&e.jsx("button",{onClick:()=>M(o),className:"inline-flex items-center p-1.5 rounded-md text-red-600 hover:bg-red-50 transition",title:"Delete",children:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})})]})]},o.id)})})]})}),!s&&t.length>0&&e.jsxs("div",{className:"px-6 py-4 border-t border-gray-200 flex items-center justify-between",children:[e.jsxs("div",{className:"text-sm text-gray-600",children:["Showing ",(r.page-1)*r.limit+1," to"," ",Math.min(r.page*r.limit,r.total)," of"," ",r.total," visitors"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:O,disabled:r.page===1,className:"px-3 py-1 border border-gray-300 rounded-lg text-sm font-medium text-gray-700 hover:bg-gray-50 disabled:text-gray-400 disabled:cursor-not-allowed transition",children:"Previous"}),e.jsx("div",{className:"flex items-center gap-1",children:(()=>{const o=r.page,u=r.totalPages,v=[];if(u<=7)for(let c=1;c<=u;c++)v.push(c);else{v.push(1),o>3&&v.push("...");for(let c=Math.max(2,o-1);c<=Math.min(u-1,o+1);c++)v.push(c);o<u-2&&v.push("..."),v.push(u)}return v.map((c,Q)=>c==="..."?e.jsx("span",{className:"px-2 py-1 text-sm text-gray-500",children:"..."},`dots-${Q}`):e.jsx("button",{onClick:()=>j(c),className:`px-3 py-1 rounded-lg text-sm font-medium transition ${c===o?"bg-blue-600 text-white":"border border-gray-300 text-gray-700 hover:bg-gray-50"}`,children:c},c))})()}),e.jsx("button",{onClick:T,disabled:r.page===r.totalPages,className:"px-3 py-1 border border-gray-300 rounded-lg text-sm font-medium text-gray-700 hover:bg-gray-50 disabled:text-gray-400 disabled:cursor-not-allowed transition",children:"Next"})]})]})]})}function Ie({isOpen:t,onClose:s,onSubmit:r,visitData:d,hosts:m,isLoading:j,isLoadingHosts:N}){return a.useEffect(()=>(t?document.body.style.overflow="hidden":document.body.style.overflow="auto",()=>{document.body.style.overflow="auto"}),[t]),t?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-40",onClick:s}),e.jsx("div",{className:"fixed inset-0 flex items-center justify-center z-50 p-4 overflow-y-auto",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-lg max-w-md w-full my-8",children:[e.jsxs("div",{className:"flex items-center justify-between px-6 py-4 border-b border-gray-200",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:d?"Edit Visitor":"Register New Visitor"}),e.jsx("button",{onClick:s,className:"text-gray-500 hover:text-gray-700","aria-label":"Close",children:e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsx("div",{className:"px-6 py-4",children:e.jsx(ve,{onSubmit:r,initialData:d,hosts:m,isLoading:j,isLoadingHosts:N})})]})})]}):null}function Me({isOpen:t,visitor:s,onConfirm:r,onCancel:d,isLoading:m}){return a.useEffect(()=>(t?document.body.style.overflow="hidden":document.body.style.overflow="auto",()=>{document.body.style.overflow="auto"}),[t]),!t||!s?null:e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-40",onClick:d}),e.jsx("div",{className:"fixed inset-0 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-lg max-w-sm w-full",children:[e.jsx("div",{className:"flex justify-center py-6",children:e.jsx("div",{className:"flex items-center justify-center w-12 h-12 rounded-full bg-red-100",children:e.jsx("svg",{className:"w-6 h-6 text-red-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})})}),e.jsxs("div",{className:"text-center px-6 pb-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"Delete Visitor Record"}),e.jsxs("p",{className:"text-gray-600 mb-2",children:["Are you sure you want to delete ",e.jsx("span",{className:"font-medium",children:s.visitorName}),"'s record?"]}),e.jsx("p",{className:"text-sm text-gray-500",children:"This action cannot be undone."})]}),e.jsxs("div",{className:"flex gap-2 px-6 py-4 border-t border-gray-200 bg-gray-50 rounded-b-lg",children:[e.jsx("button",{onClick:d,disabled:m,className:"flex-1 px-4 py-2 border border-gray-300 rounded-lg text-sm font-medium text-gray-700 hover:bg-white disabled:bg-gray-100 transition",children:"Cancel"}),e.jsx("button",{onClick:r,disabled:m,className:"flex-1 px-4 py-2 bg-red-600 text-white rounded-lg text-sm font-medium hover:bg-red-700 disabled:bg-gray-400 transition",children:m?"Deleting...":"Delete"})]})]})})]})}function Te(){const{success:t,error:s}=xe(),[r,d]=a.useState([]),[m,j]=a.useState([]),[N,M]=a.useState(!1),[w,x]=a.useState(null),[C,S]=a.useState(!1),[h,p]=a.useState(!1),[k,i]=a.useState(),[$,f]=a.useState(!1),[V,b]=a.useState(),[H,O]=a.useState(!1),[T,F]=a.useState(!1),[,g]=a.useState(!1),[n,o]=a.useState(null),[u,v]=a.useState(!1),[c,Q]=a.useState({page:1,limit:10,total:0,totalPages:1}),[P,U]=a.useState(""),[I,q]=a.useState(""),z=a.useCallback(async()=>{S(!0);try{const l=await ye({limit:1e3});j(l.data||[])}catch{s("Failed to load hosts")}finally{S(!1)}},[s]),y=a.useCallback(async(l=1,E="",D="")=>{M(!0),x(null);try{const A={page:l,limit:c.limit};E&&(A.search=E),D&&(A.status=D);const B=await je(A);d(B.data||[]),Q({page:B.page||1,limit:B.limit||10,total:B.total||0,totalPages:B.totalPages||1})}catch{x("Failed to load visitors. Please check your connection and try again."),s("Failed to load visitors")}finally{M(!1)}},[c.limit,s]);a.useEffect(()=>{z(),y(1,"","")},[z,y]);const J=l=>{U(l),y(1,l,I)},X=l=>{q(l),y(1,P,l)},Y=l=>{y(l,P,I)},Z=async l=>{F(!0);try{k?(await we(k.id,l),t("Visitor updated successfully")):(await Ne(l),t("Visitor registered successfully")),p(!1),i(void 0),await y(c.page,P,I)}catch{s(k?"Failed to update visitor":"Failed to register visitor")}finally{F(!1)}},ee=async l=>{g(!0);try{await Se(l.id),t("Visitor approved successfully"),await y(c.page,P,I)}catch{s("Failed to approve visitor")}finally{g(!1)}},te=async l=>{g(!0);try{await ke(l.id),t("Visitor rejected"),await y(c.page,P,I)}catch{s("Failed to reject visitor")}finally{g(!1)}},se=async l=>{g(!0);try{await Ee(l.id),t("Visitor checked out successfully"),await y(c.page,P,I)}catch{s("Failed to checkout visitor")}finally{g(!1)}},oe=l=>{var E,D,A;o({id:l.id,sessionId:"",visitorName:l.visitorName,visitorCompany:(E=l.host)==null?void 0:E.company,visitorPhone:l.visitorPhone||"",visitorEmail:l.visitorEmail,hostName:((D=l.host)==null?void 0:D.name)||"",hostCompany:((A=l.host)==null?void 0:A.company)||"",purpose:l.purpose||"",checkInAt:l.checkInTime||""}),v(!0)},re=async()=>{if(V){O(!0);try{await Ce(V.id),t("Visitor record deleted successfully"),f(!1),b(void 0),await y(c.page,P,I)}catch{s("Failed to delete visitor")}finally{O(!1)}}},ne=l=>{i(l),p(!0)},le=l=>{b(l),f(!0)},ae=()=>{p(!1),i(void 0)};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Visitors Management"}),e.jsx("p",{className:"text-gray-600 mt-1",children:"Register and manage visitor check-ins"})]}),e.jsx("button",{onClick:()=>{i(void 0),p(!0)},className:"px-4 py-2 bg-blue-600 text-white rounded-lg font-medium hover:bg-blue-700 transition",children:e.jsxs("span",{className:"inline-flex items-center gap-2",children:[e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})}),"Register Visitor"]})})]}),w&&!N&&e.jsx(ge,{title:"Failed to load visitors",message:w,onRetry:()=>y(c.page,P,I)}),!w&&e.jsx(Pe,{visitors:r,isLoading:N,pagination:c,onSearch:J,onStatusFilter:X,onPageChange:Y,onEdit:ne,onDelete:le,onApprove:ee,onReject:te,onCheckout:se,onQr:oe}),e.jsx(Ie,{isOpen:h,onClose:ae,onSubmit:Z,visitData:k,hosts:m,isLoading:T,isLoadingHosts:C}),e.jsx(pe,{visitor:n,isOpen:u,onClose:()=>{v(!1),o(null)}}),e.jsx(Me,{isOpen:$,visitor:V,onConfirm:re,onCancel:()=>{f(!1),b(void 0)},isLoading:H})]})}export{Te as default};
