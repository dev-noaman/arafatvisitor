import{b as A,u as O,r as a,j as e,a as K}from"./index-DhWX03Cy.js";import{T as V,H as Y,a as Z,D as ee}from"./TeamMemberForm-DitJ5sLw.js";import{E as te}from"./ErrorState-CQnIf7eq.js";import{g as se,u as ae,c as ne,d as oe}from"./hosts-r3Q6BTCa.js";const ie=async t=>{const n=new URLSearchParams;t!=null&&t.page&&n.append("page",t.page.toString()),t!=null&&t.limit&&n.append("limit",t.limit.toString()),t!=null&&t.search&&n.append("search",t.search),(t==null?void 0:t.status)!==void 0&&n.append("status",t.status.toString()),t!=null&&t.hostId&&n.append("hostId",t.hostId);const i=n.toString(),v=`/admin/api/my-team${i?`?${i}`:""}`;return await A.get(v)},le=async t=>await A.post("/admin/api/my-team",t),re=async(t,n)=>await A.patch(`/admin/api/my-team/${t}`,n),ce=async(t,n)=>await A.patch(`/admin/api/my-team/${t}/status`,{status:n});function de({isOpen:t,onClose:n,hostId:i,hostName:v,hostCompany:N,hostLocation:u}){const{success:m,error:f}=O(),[M,T]=a.useState([]),[C,y]=a.useState(!1),[H,L]=a.useState(!1),[p,r]=a.useState(!1),[c,h]=a.useState(),x=a.useCallback(async()=>{if(!(!t||!i)){y(!0);try{const s=await ie({hostId:i,limit:100});T(s.data||[])}catch(s){f(s instanceof Error?s.message:"Failed to load team members")}finally{y(!1)}}},[i,t,f]);a.useEffect(()=>{t&&(x(),r(!1),h(void 0))},[t,x]);const w=async s=>{L(!0);try{const l={...s,hostId:i};c?(await re(String(c.id),l),m("Team member updated successfully")):(await le(l),m("Team member created successfully")),r(!1),h(void 0),x()}catch(l){f(l instanceof Error?l.message:"Failed to save team member")}finally{L(!1)}},S=s=>{h(s),r(!0)},I=async s=>{const l=s.status===1?0:1,d=l===0?"deactivate":"reactivate";if(confirm(`Are you sure you want to ${d} ${s.name}?`))try{await ce(String(s.id),l),m(`Team member ${d}d successfully`),x()}catch(k){f(k instanceof Error?k.message:`Failed to ${d} team member`)}},E=()=>{h(void 0),r(!0)},P=()=>{r(!1),h(void 0)};if(!t)return null;const D=u?String(u).replace(/_/g," "):"Not set";return e.jsx("div",{className:"fixed inset-0 z-50 overflow-y-auto",children:e.jsxs("div",{className:"flex min-h-full items-end justify-center p-4 text-center sm:items-center sm:p-0",children:[e.jsx("div",{className:"fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity",onClick:n}),e.jsxs("div",{className:"relative transform overflow-hidden rounded-lg bg-white text-left shadow-xl transition-all sm:my-8 sm:w-full sm:max-w-4xl",children:[e.jsx("div",{className:"bg-white px-6 py-4 border-b border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900",children:["Team Members - ",N]}),e.jsxs("p",{className:"text-sm text-gray-500 mt-1",children:["Host: ",v," | Location: ",D]})]}),e.jsx("button",{onClick:n,className:"rounded-md text-gray-400 hover:text-gray-500 focus:outline-none",children:e.jsx("svg",{className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]})}),e.jsx("div",{className:"bg-white px-6 py-4 max-h-[60vh] overflow-y-auto",children:p?e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h4",{className:"text-md font-medium text-gray-900",children:c?"Edit Team Member":"Add New Team Member"}),e.jsx("button",{onClick:P,className:"text-sm text-gray-500 hover:text-gray-700",children:"← Back to list"})]}),e.jsx(V,{onSubmit:w,initialData:c,isLoading:H,hostLocation:u})]}):e.jsxs("div",{children:[e.jsx("div",{className:"mb-4",children:e.jsxs("button",{onClick:E,className:"inline-flex items-center px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition",children:[e.jsx("svg",{className:"w-5 h-5 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})}),"Add Team Member"]})}),C?e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"})}):M.length===0?e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx("svg",{className:"w-12 h-12 mx-auto text-gray-300 mb-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"})}),e.jsx("p",{children:"No team members yet"}),e.jsx("p",{className:"text-sm mt-1",children:"Add your first team member to get started"})]}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full table-auto",children:[e.jsx("thead",{className:"bg-gray-50 border-b border-gray-200",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-xs font-semibold text-gray-700 uppercase tracking-wider",children:"Name"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-semibold text-gray-700 uppercase tracking-wider",children:"Email"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-semibold text-gray-700 uppercase tracking-wider",children:"Phone"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-semibold text-gray-700 uppercase tracking-wider",children:"Status"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-semibold text-gray-700 uppercase tracking-wider",children:"Actions"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200",children:M.map(s=>e.jsxs("tr",{className:"hover:bg-gray-50 transition",children:[e.jsx("td",{className:"px-4 py-3 text-sm text-gray-900 font-medium",children:s.name}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-600",children:s.email}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-600",children:s.phone||"—"}),e.jsx("td",{className:"px-4 py-3 text-sm",children:e.jsx("button",{onClick:()=>I(s),className:`inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium transition ${s.status===1?"bg-green-100 text-green-800 hover:bg-green-200":"bg-red-100 text-red-800 hover:bg-red-200"}`,title:s.status===1?"Click to deactivate":"Click to reactivate",children:s.status===1?"Active":"Inactive"})}),e.jsx("td",{className:"px-4 py-3 text-sm",children:e.jsx("button",{onClick:()=>S(s),className:"inline-flex items-center p-1.5 rounded-md text-blue-600 hover:bg-blue-50 transition",title:"Edit",children:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})})})})]},s.id))})]})})]})}),e.jsx("div",{className:"bg-gray-50 px-6 py-4 border-t border-gray-200 flex justify-end",children:e.jsx("button",{onClick:n,className:"px-4 py-2 border border-gray-300 rounded-lg text-sm font-medium text-gray-700 hover:bg-gray-50 transition",children:"Close"})})]})]})})}function ge(){const{user:t}=K(),n=(t==null?void 0:t.role)==="ADMIN",i=(t==null?void 0:t.role)==="HOST",v=(t==null?void 0:t.role)==="RECEPTION",N=n||i||v,{success:u,error:m}=O(),[f,M]=a.useState([]),[T,C]=a.useState(!1),[y,H]=a.useState(null),[L,p]=a.useState(!1),[r,c]=a.useState(),[h,x]=a.useState(!1),[w,S]=a.useState(),[I,E]=a.useState(!1),[P,D]=a.useState(!1),[s,l]=a.useState(!1),[d,k]=a.useState(),[b,B]=a.useState({page:1,limit:10,total:0,totalPages:1}),[F,R]=a.useState(""),g=a.useCallback(async(o=1,$="")=>{C(!0),H(null);try{const j=await se({page:o,limit:b.limit,search:$,type:"EXTERNAL"});M(j.data||[]),B({page:j.page||1,limit:j.limit||10,total:j.total||0,totalPages:j.totalPages||1})}catch{H("Failed to load hosts. Please check your connection and try again."),m("Failed to load hosts")}finally{C(!1)}},[b.limit,m]);a.useEffect(()=>{g(1,"")},[g]);const z=o=>{R(o),g(1,o)},W=o=>{g(o,F)},q=async o=>{D(!0);try{r?(await ae(r.id,o),u("Host updated successfully")):(await ne(o),u("Host created successfully")),p(!1),c(void 0),await g(b.page,F)}catch{m(r?"Failed to update host":"Failed to create host")}finally{D(!1)}},Q=async()=>{if(w){E(!0);try{await oe(w.id),u("Host deleted successfully"),x(!1),S(void 0),await g(b.page,F)}catch{m("Failed to delete host")}finally{E(!1)}}},U=o=>{c(o),p(!0)},X=o=>{S(o),x(!0)},_=()=>{p(!1),c(void 0)},G=o=>{k(o),l(!0)},J=()=>{l(!1),k(void 0)};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Hosts Management"}),e.jsx("p",{className:"text-gray-600 mt-1",children:"Manage companies and host contacts"})]}),n&&e.jsx("div",{className:"flex gap-3",children:e.jsx("button",{onClick:()=>{c(void 0),p(!0)},className:"px-4 py-2 bg-blue-600 text-white rounded-lg font-medium hover:bg-blue-700 transition",children:e.jsxs("span",{className:"inline-flex items-center gap-2",children:[e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})}),"Add Host"]})})})]}),y&&!T&&e.jsx(te,{title:"Failed to load hosts",message:y,onRetry:()=>g(b.page,F)}),!y&&e.jsx(Y,{hosts:f,isLoading:T,pagination:b,onSearch:z,onPageChange:W,onEdit:U,onDelete:X,onManageTeam:N?G:void 0,showTeamAction:N}),e.jsx(Z,{isOpen:L,onClose:_,onSubmit:q,hostData:r,isLoading:P}),e.jsx(ee,{isOpen:h,host:w,onConfirm:Q,onCancel:()=>{x(!1),S(void 0)},isLoading:I}),d&&e.jsx(de,{isOpen:s,onClose:J,hostId:d.id,hostName:d.name,hostCompany:d.company,hostLocation:d.location||null})]})}export{ge as default};
