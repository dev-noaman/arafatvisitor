import{r as n,b as ae,j as e,t as ne,o as oe,s as D,l as ie,_ as de,c as S,u as ce}from"./index-D8plSTyx.js";import{E as xe}from"./ErrorState-DnVHBrDi.js";import{g as ue}from"./hosts-DCHyAYMk.js";const me=oe({email:D().email("Invalid email address"),name:D().optional(),role:de(["ADMIN","RECEPTION","HOST"]),password:D().min(8,"Password must be at least 8 characters").optional().or(ie("")),hostId:D().optional()});function he({onSubmit:t,initialData:l,isLoading:r,hosts:d=[],isLoadingHosts:c}){const[u,x]=n.useState(!1),{register:m,handleSubmit:k,formState:{errors:o},reset:g,watch:b}=ae({resolver:ne(me),defaultValues:l||{email:"",name:"",role:"HOST",password:"",hostId:""}}),v=b("role"),y=async i=>{i.role!=="HOST"&&delete i.hostId,await t(i),g()};return e.jsxs("form",{onSubmit:k(y),className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"email",className:"block text-sm font-medium text-gray-700 mb-1",children:"Email *"}),e.jsx("input",{...m("email"),type:"email",id:"email",placeholder:"Enter email address",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",disabled:r||!!l}),o.email&&e.jsx("p",{className:"text-sm text-red-600 mt-1",children:o.email.message})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"name",className:"block text-sm font-medium text-gray-700 mb-1",children:"Full Name"}),e.jsx("input",{...m("name"),type:"text",id:"name",placeholder:"Enter full name",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",disabled:r}),o.name&&e.jsx("p",{className:"text-sm text-red-600 mt-1",children:o.name.message})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"role",className:"block text-sm font-medium text-gray-700 mb-1",children:"Role *"}),e.jsxs("select",{...m("role"),id:"role",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",disabled:r,children:[e.jsx("option",{value:"HOST",children:"Host (Employee)"}),e.jsx("option",{value:"RECEPTION",children:"Reception"}),e.jsx("option",{value:"ADMIN",children:"Administrator"})]}),o.role&&e.jsx("p",{className:"text-sm text-red-600 mt-1",children:o.role.message})]}),v==="HOST"&&e.jsxs("div",{children:[e.jsx("label",{htmlFor:"hostId",className:"block text-sm font-medium text-gray-700 mb-1",children:"Linked Host/Company *"}),e.jsxs("select",{...m("hostId"),id:"hostId",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",disabled:r||c,children:[e.jsx("option",{value:"",children:"Select a host..."}),d.map(i=>e.jsxs("option",{value:i.id,children:[i.name," — ",i.company]},i.id))]}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"HOST users can only see data belonging to their linked company"})]}),!l&&e.jsxs("div",{children:[e.jsx("label",{htmlFor:"password",className:"block text-sm font-medium text-gray-700 mb-1",children:"Password * (minimum 8 characters)"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{...m("password"),type:u?"text":"password",id:"password",placeholder:"Enter password",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 pr-10",disabled:r}),e.jsx("button",{type:"button",onClick:()=>x(!u),className:"absolute right-3 top-2.5 text-gray-500 hover:text-gray-700",tabIndex:-1,children:u?e.jsxs("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13.875 18.825A10.05 10.05 0 0112 19c-4.478 0-8.268-2.943-9.543-7a9.97 9.97 0 011.563-4.803c1.079-1.35 2.587-2.417 4.236-2.957"}),e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9.879 7.519c1.171-1.025 2.56-1.52 4.121-1.52 3.773 0 6.867 3.06 6.867 6.84 0 1.329-.196 2.605-.57 3.824m2.568-9.64A9 9 0 0121 12a9 9 0 01-9 9m0 0a9 9 0 01-9-9 9 9 0 019-9"})]}):e.jsxs("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"}),e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"})]})})]}),o.password&&e.jsx("p",{className:"text-sm text-red-600 mt-1",children:o.password.message})]}),e.jsx("button",{type:"submit",disabled:r,className:"w-full px-4 py-2 bg-blue-600 text-white rounded-lg font-medium hover:bg-blue-700 disabled:bg-gray-400 transition",children:r?"Saving...":l?"Update User":"Create User"})]})}const ge=async t=>{const l=new URLSearchParams;t!=null&&t.page&&l.append("page",t.page.toString()),t!=null&&t.limit&&l.append("limit",t.limit.toString()),t!=null&&t.search&&l.append("search",t.search),t!=null&&t.role&&l.append("role",t.role),t!=null&&t.status&&l.append("status",t.status),t!=null&&t.sortBy&&l.append("sortBy",t.sortBy),t!=null&&t.sortOrder&&l.append("sortOrder",t.sortOrder);const r=l.toString(),d=`/admin/api/users${r?`?${r}`:""}`;return await S.get(d)},be=async t=>await S.post("/admin/api/users",t),ye=async(t,l)=>await S.put(`/admin/api/users/${t}`,l),fe=async t=>await S.delete(`/admin/api/users/${t}`),pe=async t=>await S.post(`/admin/api/users/${t}/deactivate`,{}),je=async t=>await S.post(`/admin/api/users/${t}/activate`,{}),V=t=>({ADMIN:"bg-red-100 text-red-800",RECEPTION:"bg-blue-100 text-blue-800",HOST:"bg-green-100 text-green-800"})[t]||"bg-gray-100 text-gray-800",B=t=>({ADMIN:"Administrator",RECEPTION:"Reception",HOST:"Host"})[t]||t,W=t=>t?{ACTIVE:"bg-green-100 text-green-800",INACTIVE:"bg-gray-100 text-gray-800"}[t]||"bg-gray-100 text-gray-800":"bg-green-100 text-green-800",z=t=>t?{ACTIVE:"Active",INACTIVE:"Inactive"}[t]||t:"Active",Ne=["ADMIN","RECEPTION","HOST"],ve=["ACTIVE","INACTIVE"];function we({users:t,isLoading:l,pagination:r,onSearch:d,onRoleFilter:c,onStatusFilter:u,onPageChange:x,onEdit:m,onDelete:k,onToggleStatus:o}){const[g,b]=n.useState(""),[v,y]=n.useState(""),[i,C]=n.useState(""),R=s=>{const w=s.target.value;b(w),d(w)},E=s=>{y(s),c(s)},F=s=>{C(s),u(s)},T=()=>{r.page>1&&x(r.page-1)},L=()=>{r.page<r.totalPages&&x(r.page+1)};return e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200",children:[e.jsxs("div",{className:"p-6 border-b border-gray-200 space-y-4",children:[e.jsx("div",{children:e.jsx("input",{type:"text",placeholder:"Search by email or name...",value:g,onChange:R,className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"})}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Filter by Role"}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsx("button",{onClick:()=>E(""),className:`px-3 py-1 rounded-full text-sm font-medium transition ${v===""?"bg-blue-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:"All"}),Ne.map(s=>e.jsx("button",{onClick:()=>E(s),className:`px-3 py-1 rounded-full text-sm font-medium transition ${v===s?"bg-blue-600 text-white":`${V(s)} hover:opacity-80`}`,children:B(s)},s))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Filter by Status"}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsx("button",{onClick:()=>F(""),className:`px-3 py-1 rounded-full text-sm font-medium transition ${i===""?"bg-blue-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:"All"}),ve.map(s=>e.jsx("button",{onClick:()=>F(s),className:`px-3 py-1 rounded-full text-sm font-medium transition ${i===s?"bg-blue-600 text-white":`${W(s)} hover:opacity-80`}`,children:z(s)},s))]})]})]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50 border-b border-gray-200",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-sm font-semibold text-gray-700",children:"User Name"}),e.jsx("th",{className:"px-6 py-3 text-left text-sm font-semibold text-gray-700",children:"Email"}),e.jsx("th",{className:"px-6 py-3 text-left text-sm font-semibold text-gray-700",children:"Role"}),e.jsx("th",{className:"px-6 py-3 text-left text-sm font-semibold text-gray-700",children:"Status"}),e.jsx("th",{className:"px-6 py-3 text-left text-sm font-semibold text-gray-700",children:"Created Date"}),e.jsx("th",{className:"px-6 py-3 text-left text-sm font-semibold text-gray-700",children:"Actions"})]})}),e.jsx("tbody",{children:l?e.jsx("tr",{children:e.jsx("td",{colSpan:6,className:"px-6 py-8 text-center text-gray-500",children:e.jsx("div",{className:"flex items-center justify-center",children:e.jsx("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-blue-600"})})})}):t.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:6,className:"px-6 py-8 text-center text-gray-500",children:"No users found."})}):t.map(s=>e.jsxs("tr",{className:"border-b border-gray-200 hover:bg-gray-50 transition",children:[e.jsx("td",{className:"px-6 py-4 text-sm text-gray-900 font-medium",children:s.name||"—"}),e.jsx("td",{className:"px-6 py-4 text-sm text-gray-600",children:s.email}),e.jsx("td",{className:"px-6 py-4 text-sm",children:e.jsx("span",{className:`inline-block px-2 py-1 rounded-full text-xs font-medium ${V(s.role)}`,children:B(s.role)})}),e.jsx("td",{className:"px-6 py-4 text-sm",children:e.jsx("span",{className:`inline-block px-2 py-1 rounded-full text-xs font-medium ${W(s.status)}`,children:z(s.status)})}),e.jsx("td",{className:"px-6 py-4 text-sm text-gray-600",children:new Date(s.createdAt).toLocaleDateString()}),e.jsxs("td",{className:"px-6 py-4 text-sm space-x-1",children:[o&&e.jsx("button",{onClick:()=>o(s),className:`inline-flex items-center px-2 py-1 rounded-md text-xs font-medium transition ${s.status==="ACTIVE"?"text-orange-600 hover:bg-orange-50":"text-green-600 hover:bg-green-50"}`,children:s.status==="ACTIVE"?"Deactivate":"Activate"}),e.jsx("button",{onClick:()=>m(s),className:"inline-flex items-center px-2 py-1 rounded-md text-xs font-medium text-blue-600 hover:bg-blue-50 transition",children:"Edit"}),e.jsx("button",{onClick:()=>k(s),className:"inline-flex items-center px-2 py-1 rounded-md text-xs font-medium text-red-600 hover:bg-red-50 transition",children:"Delete"})]})]},s.id))})]})}),!l&&t.length>0&&e.jsxs("div",{className:"px-6 py-4 border-t border-gray-200 flex items-center justify-between",children:[e.jsxs("div",{className:"text-sm text-gray-600",children:["Showing ",(r.page-1)*r.limit+1," to"," ",Math.min(r.page*r.limit,r.total)," of ",r.total," ","users"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:T,disabled:r.page===1,className:"px-3 py-1 border border-gray-300 rounded-lg text-sm font-medium text-gray-700 hover:bg-gray-50 disabled:text-gray-400 disabled:cursor-not-allowed transition",children:"Previous"}),e.jsx("div",{className:"flex items-center gap-1",children:Array.from({length:r.totalPages},(s,w)=>w+1).map(s=>e.jsx("button",{onClick:()=>x(s),className:`px-3 py-1 rounded-lg text-sm font-medium transition ${s===r.page?"bg-blue-600 text-white":"border border-gray-300 text-gray-700 hover:bg-gray-50"}`,children:s},s))}),e.jsx("button",{onClick:L,disabled:r.page===r.totalPages,className:"px-3 py-1 border border-gray-300 rounded-lg text-sm font-medium text-gray-700 hover:bg-gray-50 disabled:text-gray-400 disabled:cursor-not-allowed transition",children:"Next"})]})]})]})}function Se({isOpen:t,onClose:l,onSubmit:r,userData:d,isLoading:c,hosts:u,isLoadingHosts:x}){return n.useEffect(()=>(t?document.body.style.overflow="hidden":document.body.style.overflow="auto",()=>{document.body.style.overflow="auto"}),[t]),t?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-40",onClick:l}),e.jsx("div",{className:"fixed inset-0 flex items-center justify-center z-50 p-4 overflow-y-auto",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-lg max-w-md w-full my-8",children:[e.jsxs("div",{className:"flex items-center justify-between px-6 py-4 border-b border-gray-200",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:d?"Edit User":"Create New User"}),e.jsx("button",{onClick:l,className:"text-gray-500 hover:text-gray-700","aria-label":"Close",children:e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsx("div",{className:"px-6 py-4",children:e.jsx(he,{onSubmit:r,initialData:d,isLoading:c,hosts:u,isLoadingHosts:x})})]})})]}):null}function ke({isOpen:t,user:l,onConfirm:r,onCancel:d,isLoading:c}){return n.useEffect(()=>(t?document.body.style.overflow="hidden":document.body.style.overflow="auto",()=>{document.body.style.overflow="auto"}),[t]),!t||!l?null:e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-40",onClick:d}),e.jsx("div",{className:"fixed inset-0 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-lg max-w-sm w-full",children:[e.jsx("div",{className:"flex justify-center py-6",children:e.jsx("div",{className:"flex items-center justify-center w-12 h-12 rounded-full bg-red-100",children:e.jsx("svg",{className:"w-6 h-6 text-red-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})})}),e.jsxs("div",{className:"text-center px-6 pb-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"Delete User Account"}),e.jsxs("p",{className:"text-gray-600 mb-2",children:["Are you sure you want to delete ",e.jsx("span",{className:"font-medium",children:l.email}),"?"]}),e.jsx("p",{className:"text-sm text-gray-500",children:"This action cannot be undone. The user will no longer have access to the system."})]}),e.jsxs("div",{className:"flex gap-2 px-6 py-4 border-t border-gray-200 bg-gray-50 rounded-b-lg",children:[e.jsx("button",{onClick:d,disabled:c,className:"flex-1 px-4 py-2 border border-gray-300 rounded-lg text-sm font-medium text-gray-700 hover:bg-white disabled:bg-gray-100 transition",children:"Cancel"}),e.jsx("button",{onClick:r,disabled:c,className:"flex-1 px-4 py-2 bg-red-600 text-white rounded-lg text-sm font-medium hover:bg-red-700 disabled:bg-gray-400 transition",children:c?"Deleting...":"Delete"})]})]})})]})}function Ae(){const{success:t,error:l}=ce(),[r,d]=n.useState([]),[c,u]=n.useState(!1),[x,m]=n.useState(null),[k,o]=n.useState(!1),[g,b]=n.useState(),[v,y]=n.useState(!1),[i,C]=n.useState(),[R,E]=n.useState(!1),[F,T]=n.useState(!1),[L,s]=n.useState([]),[w,M]=n.useState(!1),[,O]=n.useState(!1),[f,Q]=n.useState({page:1,limit:10,total:0,totalPages:1}),[p,_]=n.useState(""),[j,q]=n.useState(""),[N,G]=n.useState(""),P=n.useCallback(async()=>{M(!0);try{const a=await ue({limit:100});s(a.data||[])}catch{}finally{M(!1)}},[]),h=n.useCallback(async(a=1,U="",H="",$="")=>{u(!0),m(null);try{const I={page:a,limit:f.limit};U&&(I.search=U),H&&(I.role=H),$&&(I.status=$);const A=await ge(I);d(A.data||[]),Q({page:A.page||1,limit:A.limit||10,total:A.total||0,totalPages:A.totalPages||1})}catch{m("Failed to load users. Please check your connection and try again."),l("Failed to load users")}finally{u(!1)}},[f.limit,l]);n.useEffect(()=>{P(),h(1,"","","")},[P,h]);const J=a=>{_(a),h(1,a,j,N)},K=a=>{q(a),h(1,p,a,N)},X=a=>{G(a),h(1,p,j,a)},Y=a=>{h(a,p,j,N)},Z=async a=>{T(!0);try{g?(await ye(g.id,a),t("User updated successfully")):(await be(a),t("User created successfully")),o(!1),b(void 0),await h(f.page,p,j,N)}catch{l(g?"Failed to update user":"Failed to create user")}finally{T(!1)}},ee=async a=>{O(!0);try{a.status==="ACTIVE"?(await pe(a.id),t("User deactivated successfully")):(await je(a.id),t("User activated successfully")),await h(f.page,p,j,N)}catch{l("Failed to update user status")}finally{O(!1)}},te=async()=>{if(i){E(!0);try{await fe(i.id),t("User deleted successfully"),y(!1),C(void 0),await h(f.page,p,j,N)}catch{l("Failed to delete user")}finally{E(!1)}}},se=a=>{b(a),o(!0)},le=a=>{C(a),y(!0)},re=()=>{o(!1),b(void 0)};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Users Management"}),e.jsx("p",{className:"text-gray-600 mt-1",children:"Manage system users and access control"})]}),e.jsx("button",{onClick:()=>{b(void 0),o(!0)},className:"px-4 py-2 bg-blue-600 text-white rounded-lg font-medium hover:bg-blue-700 transition",children:e.jsxs("span",{className:"inline-flex items-center gap-2",children:[e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})}),"Add User"]})})]}),x&&!c&&e.jsx(xe,{title:"Failed to load users",message:x,onRetry:()=>h(f.page,p,j,N)}),!x&&e.jsx(we,{users:r,isLoading:c,pagination:f,onSearch:J,onRoleFilter:K,onStatusFilter:X,onPageChange:Y,onEdit:se,onDelete:le,onToggleStatus:ee}),e.jsx(Se,{isOpen:k,onClose:re,onSubmit:Z,userData:g,isLoading:F,hosts:L,isLoadingHosts:w}),e.jsx(ke,{isOpen:v,user:i,onConfirm:te,onCancel:()=>{y(!1),C(void 0)},isLoading:R})]})}export{Ae as default};
