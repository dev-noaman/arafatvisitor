import{r as n,b as ee,j as e,t as te,o as se,s as R,l as re,_ as le,c as N,u as ae}from"./index-B5L_DzKs.js";import{E as ne}from"./ErrorState-COsxgZo2.js";const oe=se({email:R().email("Invalid email address"),name:R().optional(),role:le(["ADMIN","RECEPTION","HOST"]),password:R().min(8,"Password must be at least 8 characters").optional().or(re(""))});function ie({onSubmit:t,initialData:r,isLoading:l}){const[o,i]=n.useState(!1),{register:x,handleSubmit:u,formState:{errors:d},reset:v}=ee({resolver:te(oe),defaultValues:r||{email:"",name:"",role:"HOST",password:""}}),m=async h=>{await t(h),v()};return e.jsxs("form",{onSubmit:u(m),className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"email",className:"block text-sm font-medium text-gray-700 mb-1",children:"Email *"}),e.jsx("input",{...x("email"),type:"email",id:"email",placeholder:"Enter email address",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",disabled:l||!!r}),d.email&&e.jsx("p",{className:"text-sm text-red-600 mt-1",children:d.email.message})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"name",className:"block text-sm font-medium text-gray-700 mb-1",children:"Full Name"}),e.jsx("input",{...x("name"),type:"text",id:"name",placeholder:"Enter full name",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",disabled:l}),d.name&&e.jsx("p",{className:"text-sm text-red-600 mt-1",children:d.name.message})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"role",className:"block text-sm font-medium text-gray-700 mb-1",children:"Role *"}),e.jsxs("select",{...x("role"),id:"role",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",disabled:l,children:[e.jsx("option",{value:"HOST",children:"Host (Employee)"}),e.jsx("option",{value:"RECEPTION",children:"Reception"}),e.jsx("option",{value:"ADMIN",children:"Administrator"})]}),d.role&&e.jsx("p",{className:"text-sm text-red-600 mt-1",children:d.role.message})]}),!r&&e.jsxs("div",{children:[e.jsx("label",{htmlFor:"password",className:"block text-sm font-medium text-gray-700 mb-1",children:"Password * (minimum 8 characters)"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{...x("password"),type:o?"text":"password",id:"password",placeholder:"Enter password",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 pr-10",disabled:l}),e.jsx("button",{type:"button",onClick:()=>i(!o),className:"absolute right-3 top-2.5 text-gray-500 hover:text-gray-700",tabIndex:-1,children:o?e.jsxs("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13.875 18.825A10.05 10.05 0 0112 19c-4.478 0-8.268-2.943-9.543-7a9.97 9.97 0 011.563-4.803c1.079-1.35 2.587-2.417 4.236-2.957"}),e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9.879 7.519c1.171-1.025 2.56-1.52 4.121-1.52 3.773 0 6.867 3.06 6.867 6.84 0 1.329-.196 2.605-.57 3.824m2.568-9.64A9 9 0 0121 12a9 9 0 01-9 9m0 0a9 9 0 01-9-9 9 9 0 019-9"})]}):e.jsxs("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"}),e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"})]})})]}),d.password&&e.jsx("p",{className:"text-sm text-red-600 mt-1",children:d.password.message})]}),e.jsx("button",{type:"submit",disabled:l,className:"w-full px-4 py-2 bg-blue-600 text-white rounded-lg font-medium hover:bg-blue-700 disabled:bg-gray-400 transition",children:l?"Saving...":r?"Update User":"Create User"})]})}const de=async t=>{const r=new URLSearchParams;t!=null&&t.page&&r.append("page",t.page.toString()),t!=null&&t.limit&&r.append("limit",t.limit.toString()),t!=null&&t.search&&r.append("search",t.search),t!=null&&t.role&&r.append("role",t.role),t!=null&&t.status&&r.append("status",t.status),t!=null&&t.sortBy&&r.append("sortBy",t.sortBy),t!=null&&t.sortOrder&&r.append("sortOrder",t.sortOrder);const l=r.toString(),o=`/admin/api/users${l?`?${l}`:""}`;return await N.get(o)},ce=async t=>await N.post("/admin/api/users",t),xe=async(t,r)=>await N.put(`/admin/api/users/${t}`,r),ue=async t=>await N.delete(`/admin/api/users/${t}`),me=async t=>await N.post(`/admin/api/users/${t}/deactivate`,{}),he=async t=>await N.post(`/admin/api/users/${t}/activate`,{}),L=t=>({ADMIN:"bg-red-100 text-red-800",RECEPTION:"bg-blue-100 text-blue-800",HOST:"bg-green-100 text-green-800"})[t]||"bg-gray-100 text-gray-800",O=t=>({ADMIN:"Administrator",RECEPTION:"Reception",HOST:"Host"})[t]||t,$=t=>t?{ACTIVE:"bg-green-100 text-green-800",INACTIVE:"bg-gray-100 text-gray-800"}[t]||"bg-gray-100 text-gray-800":"bg-green-100 text-green-800",V=t=>t?{ACTIVE:"Active",INACTIVE:"Inactive"}[t]||t:"Active",ge=["ADMIN","RECEPTION","HOST"],be=["ACTIVE","INACTIVE"];function ye({users:t,isLoading:r,pagination:l,onSearch:o,onRoleFilter:i,onStatusFilter:x,onPageChange:u,onEdit:d,onDelete:v,onToggleStatus:m}){const[h,f]=n.useState(""),[A,w]=n.useState(""),[p,S]=n.useState(""),D=s=>{const j=s.target.value;f(j),o(j)},k=s=>{w(s),i(s)},I=s=>{S(s),x(s)},U=()=>{l.page>1&&u(l.page-1)},F=()=>{l.page<l.totalPages&&u(l.page+1)};return e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200",children:[e.jsxs("div",{className:"p-6 border-b border-gray-200 space-y-4",children:[e.jsx("div",{children:e.jsx("input",{type:"text",placeholder:"Search by email or name...",value:h,onChange:D,className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"})}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Filter by Role"}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsx("button",{onClick:()=>k(""),className:`px-3 py-1 rounded-full text-sm font-medium transition ${A===""?"bg-blue-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:"All"}),ge.map(s=>e.jsx("button",{onClick:()=>k(s),className:`px-3 py-1 rounded-full text-sm font-medium transition ${A===s?"bg-blue-600 text-white":`${L(s)} hover:opacity-80`}`,children:O(s)},s))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Filter by Status"}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsx("button",{onClick:()=>I(""),className:`px-3 py-1 rounded-full text-sm font-medium transition ${p===""?"bg-blue-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:"All"}),be.map(s=>e.jsx("button",{onClick:()=>I(s),className:`px-3 py-1 rounded-full text-sm font-medium transition ${p===s?"bg-blue-600 text-white":`${$(s)} hover:opacity-80`}`,children:V(s)},s))]})]})]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50 border-b border-gray-200",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-sm font-semibold text-gray-700",children:"User Name"}),e.jsx("th",{className:"px-6 py-3 text-left text-sm font-semibold text-gray-700",children:"Email"}),e.jsx("th",{className:"px-6 py-3 text-left text-sm font-semibold text-gray-700",children:"Role"}),e.jsx("th",{className:"px-6 py-3 text-left text-sm font-semibold text-gray-700",children:"Status"}),e.jsx("th",{className:"px-6 py-3 text-left text-sm font-semibold text-gray-700",children:"Created Date"}),e.jsx("th",{className:"px-6 py-3 text-left text-sm font-semibold text-gray-700",children:"Actions"})]})}),e.jsx("tbody",{children:r?e.jsx("tr",{children:e.jsx("td",{colSpan:6,className:"px-6 py-8 text-center text-gray-500",children:e.jsx("div",{className:"flex items-center justify-center",children:e.jsx("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-blue-600"})})})}):t.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:6,className:"px-6 py-8 text-center text-gray-500",children:"No users found."})}):t.map(s=>e.jsxs("tr",{className:"border-b border-gray-200 hover:bg-gray-50 transition",children:[e.jsx("td",{className:"px-6 py-4 text-sm text-gray-900 font-medium",children:s.name||"â€”"}),e.jsx("td",{className:"px-6 py-4 text-sm text-gray-600",children:s.email}),e.jsx("td",{className:"px-6 py-4 text-sm",children:e.jsx("span",{className:`inline-block px-2 py-1 rounded-full text-xs font-medium ${L(s.role)}`,children:O(s.role)})}),e.jsx("td",{className:"px-6 py-4 text-sm",children:e.jsx("span",{className:`inline-block px-2 py-1 rounded-full text-xs font-medium ${$(s.status)}`,children:V(s.status)})}),e.jsx("td",{className:"px-6 py-4 text-sm text-gray-600",children:new Date(s.createdAt).toLocaleDateString()}),e.jsxs("td",{className:"px-6 py-4 text-sm space-x-1",children:[m&&e.jsx("button",{onClick:()=>m(s),className:`inline-flex items-center px-2 py-1 rounded-md text-xs font-medium transition ${s.status==="ACTIVE"?"text-orange-600 hover:bg-orange-50":"text-green-600 hover:bg-green-50"}`,children:s.status==="ACTIVE"?"Deactivate":"Activate"}),e.jsx("button",{onClick:()=>d(s),className:"inline-flex items-center px-2 py-1 rounded-md text-xs font-medium text-blue-600 hover:bg-blue-50 transition",children:"Edit"}),e.jsx("button",{onClick:()=>v(s),className:"inline-flex items-center px-2 py-1 rounded-md text-xs font-medium text-red-600 hover:bg-red-50 transition",children:"Delete"})]})]},s.id))})]})}),!r&&t.length>0&&e.jsxs("div",{className:"px-6 py-4 border-t border-gray-200 flex items-center justify-between",children:[e.jsxs("div",{className:"text-sm text-gray-600",children:["Showing ",(l.page-1)*l.limit+1," to"," ",Math.min(l.page*l.limit,l.total)," of ",l.total," ","users"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:U,disabled:l.page===1,className:"px-3 py-1 border border-gray-300 rounded-lg text-sm font-medium text-gray-700 hover:bg-gray-50 disabled:text-gray-400 disabled:cursor-not-allowed transition",children:"Previous"}),e.jsx("div",{className:"flex items-center gap-1",children:Array.from({length:l.totalPages},(s,j)=>j+1).map(s=>e.jsx("button",{onClick:()=>u(s),className:`px-3 py-1 rounded-lg text-sm font-medium transition ${s===l.page?"bg-blue-600 text-white":"border border-gray-300 text-gray-700 hover:bg-gray-50"}`,children:s},s))}),e.jsx("button",{onClick:F,disabled:l.page===l.totalPages,className:"px-3 py-1 border border-gray-300 rounded-lg text-sm font-medium text-gray-700 hover:bg-gray-50 disabled:text-gray-400 disabled:cursor-not-allowed transition",children:"Next"})]})]})]})}function fe({isOpen:t,onClose:r,onSubmit:l,userData:o,isLoading:i}){return n.useEffect(()=>(t?document.body.style.overflow="hidden":document.body.style.overflow="auto",()=>{document.body.style.overflow="auto"}),[t]),t?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-40",onClick:r}),e.jsx("div",{className:"fixed inset-0 flex items-center justify-center z-50 p-4 overflow-y-auto",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-lg max-w-md w-full my-8",children:[e.jsxs("div",{className:"flex items-center justify-between px-6 py-4 border-b border-gray-200",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:o?"Edit User":"Create New User"}),e.jsx("button",{onClick:r,className:"text-gray-500 hover:text-gray-700","aria-label":"Close",children:e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsx("div",{className:"px-6 py-4",children:e.jsx(ie,{onSubmit:l,initialData:o,isLoading:i})})]})})]}):null}function pe({isOpen:t,user:r,onConfirm:l,onCancel:o,isLoading:i}){return n.useEffect(()=>(t?document.body.style.overflow="hidden":document.body.style.overflow="auto",()=>{document.body.style.overflow="auto"}),[t]),!t||!r?null:e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-40",onClick:o}),e.jsx("div",{className:"fixed inset-0 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-lg max-w-sm w-full",children:[e.jsx("div",{className:"flex justify-center py-6",children:e.jsx("div",{className:"flex items-center justify-center w-12 h-12 rounded-full bg-red-100",children:e.jsx("svg",{className:"w-6 h-6 text-red-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})})}),e.jsxs("div",{className:"text-center px-6 pb-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"Delete User Account"}),e.jsxs("p",{className:"text-gray-600 mb-2",children:["Are you sure you want to delete ",e.jsx("span",{className:"font-medium",children:r.email}),"?"]}),e.jsx("p",{className:"text-sm text-gray-500",children:"This action cannot be undone. The user will no longer have access to the system."})]}),e.jsxs("div",{className:"flex gap-2 px-6 py-4 border-t border-gray-200 bg-gray-50 rounded-b-lg",children:[e.jsx("button",{onClick:o,disabled:i,className:"flex-1 px-4 py-2 border border-gray-300 rounded-lg text-sm font-medium text-gray-700 hover:bg-white disabled:bg-gray-100 transition",children:"Cancel"}),e.jsx("button",{onClick:l,disabled:i,className:"flex-1 px-4 py-2 bg-red-600 text-white rounded-lg text-sm font-medium hover:bg-red-700 disabled:bg-gray-400 transition",children:i?"Deleting...":"Delete"})]})]})})]})}function ve(){const{success:t,error:r}=ae(),[l,o]=n.useState([]),[i,x]=n.useState(!1),[u,d]=n.useState(null),[v,m]=n.useState(!1),[h,f]=n.useState(),[A,w]=n.useState(!1),[p,S]=n.useState(),[D,k]=n.useState(!1),[I,U]=n.useState(!1),[,F]=n.useState(!1),[s,j]=n.useState({page:1,limit:10,total:0,totalPages:1}),[g,B]=n.useState(""),[b,H]=n.useState(""),[y,W]=n.useState(""),c=n.useCallback(async(a=1,T="",M="",P="")=>{x(!0),d(null);try{const C={page:a,limit:s.limit};T&&(C.search=T),M&&(C.role=M),P&&(C.status=P);const E=await de(C);o(E.data||[]),j({page:E.page||1,limit:E.limit||10,total:E.total||0,totalPages:E.totalPages||1})}catch{d("Failed to load users. Please check your connection and try again."),r("Failed to load users")}finally{x(!1)}},[s.limit,r]);n.useEffect(()=>{c(1,"","","")},[c]);const z=a=>{B(a),c(1,a,b,y)},Q=a=>{H(a),c(1,g,a,y)},_=a=>{W(a),c(1,g,b,a)},q=a=>{c(a,g,b,y)},G=async a=>{U(!0);try{h?(await xe(h.id,a),t("User updated successfully")):(await ce(a),t("User created successfully")),m(!1),f(void 0),await c(s.page,g,b,y)}catch{r(h?"Failed to update user":"Failed to create user")}finally{U(!1)}},J=async a=>{F(!0);try{a.status==="ACTIVE"?(await me(a.id),t("User deactivated successfully")):(await he(a.id),t("User activated successfully")),await c(s.page,g,b,y)}catch{r("Failed to update user status")}finally{F(!1)}},K=async()=>{if(p){k(!0);try{await ue(p.id),t("User deleted successfully"),w(!1),S(void 0),await c(s.page,g,b,y)}catch{r("Failed to delete user")}finally{k(!1)}}},X=a=>{f(a),m(!0)},Y=a=>{S(a),w(!0)},Z=()=>{m(!1),f(void 0)};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Users Management"}),e.jsx("p",{className:"text-gray-600 mt-1",children:"Manage system users and access control"})]}),e.jsx("button",{onClick:()=>{f(void 0),m(!0)},className:"px-4 py-2 bg-blue-600 text-white rounded-lg font-medium hover:bg-blue-700 transition",children:e.jsxs("span",{className:"inline-flex items-center gap-2",children:[e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})}),"Add User"]})})]}),u&&!i&&e.jsx(ne,{title:"Failed to load users",message:u,onRetry:()=>c(s.page,g,b,y)}),!u&&e.jsx(ye,{users:l,isLoading:i,pagination:s,onSearch:z,onRoleFilter:Q,onStatusFilter:_,onPageChange:q,onEdit:X,onDelete:Y,onToggleStatus:J}),e.jsx(fe,{isOpen:v,onClose:Z,onSubmit:G,userData:h,isLoading:I}),e.jsx(pe,{isOpen:A,user:p,onConfirm:K,onCancel:()=>{w(!1),S(void 0)},isLoading:D})]})}export{ve as default};
